var AgendaCtrl={init:function(a){AgendaCtrl.onChangeTabs(),AgendaCtrl.loadCalendarDates(a.getAttribute("data-calendar")),AgendaCtrl.setupDatePickers(),AgendaCtrl.onChangeSelectEditDates(),AgendaCtrl.onClickButtonEditarSubstituicao(),AgendaCtrl.onClickButtonDeleteSubstituicao()},onClickButtonEditarSubstituicao:function(){$("[data-action='edit-substituicao']").on("click",function(a){a.preventDefault();var t=$(a.currentTarget),e=$("#edit-alteracao-agenda");App.loader.show(),axios.get(t.attr("href")).then(function(a){a=a.data,e.find("form").trigger("reset"),e.find("input#edit_alteracao_from").val(window.App.formataValor(a.from,2)),e.find("input#edit_alteracao_to").val(window.App.formataValor(a.to,2)),e.find("input#edit_alteracao_agenda").val(a.tipo_alteracao),e.find("input[name='tipo_alteracao']").val(a.tipo),e.find("input[name='index']").val(a.from),App.loader.hide(),e.modal()})})},onClickButtonDeleteSubstituicao:function(){$("[data-action='delete_substituicao']").on("click",function(a){a.preventDefault();var t=$("input[name='delete_substituicao']");t.val("on"),t.parents("form").trigger("submit")})},onChangeTabs:function(){$("#tabs_agenda li a").on("click",function(a){var t=$(a.currentTarget),e=$("ul#tabs_agenda li a:not([href='"+t.attr("href")+"'])"),r=e.length,n=function(a,t){for(var e=$(a.attr("href")).find("input, select"),r=e.length,n=0;n<r;n++){var i=$(e[n]);if("Search"===i.attr("aria-label"))return;t?(i.attr("disabled",!0),i.removeAttr("required"),i.removeAttr("data-required")):(i.removeAttr("disabled"),i.attr("required",!0),i.attr("data-required",!0)),i.hasClass("boostrap-select-custom")&&i.selectpicker("refresh")}};n(t,!1);for(var i=0;i<r;i++){n($(e[i]),!0)}})},loadCalendarDates:function(a){a&&axios.get(a).then(function(a){a=a.data,AgendaCtrl.setupCalendar(a)})},setupCalendar:function(a){Plugins.loadLibCalendar(function(){$(".loader-calendar").addClass("hide"),$("#service-calendar").fullCalendar({defaultView:"month",monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],header:{left:"title",right:"today prev,next"},buttonText:{today:"Hoje"},events:a,eventRender:AgendaCtrl.onRenderDateCalendar,eventClick:AgendaCtrl.onClickDateCalendar})})},setupDatePickers:function(){Plugins.loadLibDateRanger(function(){for(var a={minDate:new Date,singleDatePicker:!0,autoUpdateInput:!1,locale:{format:"DD/MM/YYYY",daysOfWeek:["Do","2º","3º","4º","5º","6º","Sá"],monthNames:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]}},t=$(".datepicker"),e=t.length,r=0;r<e;r++)!function(e){var r=$(t[e]),n=$(r.attr("data-range"));r.daterangepicker(a),n.daterangepicker(a),r.on("apply.daterangepicker",function(t,e){$(t.currentTarget).val(e.startDate.format(a.locale.format)),n.data("daterangepicker").setMinDate(e.startDate)}),n.on("apply.daterangepicker",function(t,e){$(t.currentTarget).val(e.startDate.format(a.locale.format)),r.data("daterangepicker").setMaxDate(e.startDate)})}(r)})},onChangeSelectEditDates:function(){$("select#select_edit_option").on("change",function(a){var t=$(a.currentTarget),e=$("[data-option='"+t.val()+"']"),r=$(".fields-edit .field").not(e);r.find("input").removeAttr("required").removeAttr("data-required").attr("disabled",!0),r.addClass("hide"),e.find("input").removeAttr("disabled").attr("required",!0).attr("data-required",!0),e.removeClass("hide")})},onRenderDateCalendar:function(a,t,e){var r=e.title.replace(/[0-9]/g,"").trim(),n="<p class='fc-text mt-0'>Consumido <span class=\"pull-right\">"+a.consumido+"</span></p>";n+="<p class='fc-text'>Disponível <span class=\"pull-right\">"+a.disponivel+"</span></p>",n+="<p class='fc-text mt-3'>Tarifa <span class=\"pull-right\">"+a.valor_net+"</span></p>",n+="<p class='fc-info-date'>"+a.title.replace("Data ","")+"</p>",t.find(".fc-content").append(n),r!==a.mes&&t.removeClass("fc-bg-red-cad fc-bg-orange-cad fc-bg-green-cad").addClass("fc-bg-other-month")},onClickDateCalendar:function(a){var t=$("#modal-view-event");App.loader.show(),axios.get(a.view).then(function(a){a=a.data,t.find(".event-title").html(a.title),t.find("#view_date_net").val(a.valor_net),t.find("#view_date_venda").val(a.valor_venda),t.find("#view_date_qtd").val(a.disponivel),t.find("[name='data_id']").val(a.data_id);var e=AgendaCtrl.createHtmlTabs(a.servicos);$(".list-valores-servicos").html(e);var r=$("#data_servicos");r.tab(),r.find("li:first-child a").tab("show"),App.loader.hide(),t.modal()})},createHtmlTabs:function(a){for(var t="<div class='tab-content'>",e=a.length,r='<ul id="data_servicos" class="nav nav-tabs nav-tab-header">',n=0;n<e;n++){for(var i=a[n],o=i.variacoes.length,l="",d=0;d<o;d++){var s=i.variacoes[d];l+="<tr>\n                        <td>"+s.variacao+" <sup>"+s.comissao+'%</small></td>\n                        <td class="text-right">'+s.valor_net+'</td>\n                        <td class="text-right">'+s.valor_venda+"</td>\n                    </tr>"}r+='<li class="nav-item">\n                    <a class="nav-link" data-toggle="tab" href="#serv_'+i.servico_id+'">'+i.nome_tab+"</a>\n                </li>",t+='<div class="tab-pane" id="serv_'+i.servico_id+'">\n                    <div class="servico">\n                        <p class="header-table m-0">'+i.servico+'</p>\n                        <div class="table-responsive">\n                            <table class="table table-border-bottom mb-0">\n                                <thead>\n                                <tr>\n                                    <th class="pt-2 pb-2">Variação</th>\n                                    <th class="pt-2 pb-2 text-right">Tarifa net</th>\n                                    <th class="pt-2 pb-2 text-right">R$ Venda</th>\n                                </tr>\n                                </thead>\n                                <tbody>'+l+"</tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>"}return t+="</div>",r+="</ul>",r+=t}},DashboardCtrl={_dadosChart:[],init:function(){DashboardCtrl.setupChartJs()},setupChartJs:function(){Plugins.loadChartJs(function(){DashboardCtrl._dadosChart=window.dados_chart;var a=$("#line-chart-01")[0].getContext("2d");new Chart(a,{type:"line",data:{labels:DashboardCtrl._dadosChart.labels,datasets:[{label:"Ingressos vendidos",borderColor:"#5d5386",pointBackgroundColor:"#5d5386",pointHoverBorderColor:"#5d5386",pointHoverBackgroundColor:"#5d5386",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:5,fill:!0,backgroundColor:"rgba(93, 83, 134, 0.6)",borderWidth:3,data:DashboardCtrl._dadosChart.data_set}]},options:{maintainAspectRatio:!1,legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}]},tooltips:{mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.8)",titleFontSize:14,titleFontColor:"#fff",bodyFontColor:"#fff",caretSize:12,xPadding:12,displayColors:!1,yPadding:12,callbacks:{title:function(a){var t=DashboardCtrl._dadosChart.dados[a[0].index];return t.semana+" - "+t.dia+" de "+t.mes}}}}})})}},NavbarCtrl={_cookie:"menu_sidebar",init:function(){NavbarCtrl.onClickToggleMenu(),NavbarCtrl.onClickLogout();var a="close";window.innerWidth>1024&&(a=App.cookie.read(NavbarCtrl._cookie)||"close"),"open"===a&&NavbarCtrl.openSidebar()},onClickToggleMenu:function(){$("nav a#toggle-btn").on("click",function(a){a.preventDefault(),"false"===$(a.currentTarget).attr("data-sidebar")?NavbarCtrl.openSidebar():NavbarCtrl.closeSidebar()})},openSidebar:function(){$(".compact-light-sidebar").addClass("active"),$("#content-inner").removeClass("compact"),$("nav a#toggle-btn").addClass("active").attr("data-sidebar",!0),App.cookie.create(NavbarCtrl._cookie,"open",5)},closeSidebar:function(){$(".compact-light-sidebar").removeClass("active"),$("#content-inner").addClass("compact"),$("nav a#toggle-btn").removeClass("active").attr("data-sidebar",!1),App.cookie.create(NavbarCtrl._cookie,"close",5)},onClickLogout:function(){$("nav a#logout").on("click",function(a){a.preventDefault();var t=$(a.currentTarget);App.loader.show(),axios.post(t.attr("href")).then(function(a){window.location.replace(a.data.url)})})}},SidebarCtrl={init:function(){SidebarCtrl.activeMenu(),SidebarCtrl.correctScroll()},correctScroll:function(){$(".side-navbar a[data-toggle='collapse']").on("click",function(){setTimeout(function(){$(".sidebar-scroll").getNiceScroll().resize()},200)}),$(".side-navbar.sidebar-scroll").on("mouseenter",function(){$(".sidebar-scroll").getNiceScroll().resize()})},activeMenu:function(){for(var a=window.location.href,t=$(".side-navbar a.item-menu"),e=t.length,r=0;r<e;r++){var n=$(t[r]),i=n.attr("href").trim();if(-1!==a.indexOf(i)){var o=n.parents("ul").attr("id");if(void 0===o){n.parent().addClass("active");break}var l=$("a[href='#"+o+"']");if(l.parent().addClass("active"),a===i){n.parent().addClass("active"),l.click();break}}}}},ValidadorCtrl={init:function(){console.log("iniciou")}},VendasCtrl={init:function(){VendasCtrl.searchCliente(),VendasCtrl.onClickButtonValidarReserva()},searchCliente:function(){var a="",t=$(".start-result"),e=$(".not-result"),r=$(".list-results");$("#search-reserva input").on("keyup",function(n){clearTimeout(a),a=setTimeout(function(){var a=$(n.currentTarget),i=a.val().trim(),o="";i.length>2?axios.get(a.attr("data-route")+"?q="+i).then(function(a){var n=a.data.reservas||[],i=0;n.length&&(i=n.length,o=VendasCtrl.createListResultReservas(n,a.data.view)),t.addClass("hide"),0===i?(e.removeClass("hide"),r.html("")):""!==o&&(e.addClass("hide"),r.html(o))}):(r.html(""),e.addClass("hide"),t.removeClass("hide"))},500)})},createListResultReservas:function(a,t){for(var e="",r=a.length,n=0;n<r;n++){var i=a[n];e+='<li class="list-group-item lista-cliente-resultado">\n                    <a href="'+t+"/"+i.voucher+'" title="Ver reserva" target="_blank" class="d-block">\n                        <div class="other-message">\n                            <div class="media">\n                                <div class="media-left align-self-center mr-3">\n                                    <div class="media-letter medium">'+i.servico.nome.charAt(0)+'</div>\n                                </div>\n                                <div class="media-body align-self-center w-75 pr-1">\n                                    <div class="other-message-sender">Reserva #'+i.voucher+'</div>\n                                    <div class="mt-1 text-primary text-truncate d-block">('+i.quantidade+"x) "+i.servico.nome+'</div>\n                                </div>\n                                <div class="media-right align-self-center">\n                                    <i class="la la-file-text-o text-primary"></i>\n                                </div>\n                            </div>\n                        </div>\n                    </a>\n                </li>'}return e},onClickButtonValidarReserva:function(){$("[data-action='validar']").on("click",function(a){a.preventDefault();var t=$(a.currentTarget);swal({title:"Deseja autenticar este voucher?",text:" Não será possível desfazer essa ação.",icon:"warning",dangerMode:!0,buttons:["Não","Sim, autenticar"]}).then(function(a){if(a){App.loader.show();var e={reserva:t.attr("data-reserva")};axios.post(t.attr("data-url"),e).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")})}}),console.log(t)})}};
