var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},AgendaCtrl={init:function(a){AgendaCtrl.onChangeTabs(),AgendaCtrl.loadCalendarDates(a.getAttribute("data-calendar")),AgendaCtrl.setupDatePickers(),AgendaCtrl.onChangeSelectEditDates(),AgendaCtrl.onClickButtonEditarSubstituicao(),AgendaCtrl.onClickButtonDeleteSubstituicao()},onClickButtonEditarSubstituicao:function(){$("[data-action='edit-substituicao']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=$("#edit-alteracao-agenda");App.loader.show(),axios.get(e.attr("href")).then(function(a){a=a.data,t.find("form").trigger("reset"),t.find("input#edit_alteracao_from").val(window.App.formataValor(a.from,2)),t.find("input#edit_alteracao_to").val(window.App.formataValor(a.to,2)),t.find("input#edit_alteracao_agenda").val(a.tipo_alteracao),t.find("input[name='tipo_alteracao']").val(a.tipo),t.find("input[name='index']").val(a.from),App.loader.hide(),t.modal()})})},onClickButtonDeleteSubstituicao:function(){$("[data-action='delete_substituicao']").on("click",function(a){a.preventDefault();var e=$("input[name='delete_substituicao']");e.val("on"),e.parents("form").trigger("submit")})},onChangeTabs:function(){$("#tabs_agenda li a").on("click",function(a){var e=$(a.currentTarget),t=$("ul#tabs_agenda li a:not([href='"+e.attr("href")+"'])"),o=t.length,n=function(a,e){for(var t=$(a.attr("href")).find("input, select"),o=t.length,n=0;n<o;n++){var i=$(t[n]);if("Search"===i.attr("aria-label"))return;e?(i.attr("disabled",!0),i.removeAttr("required"),i.removeAttr("data-required")):(i.removeAttr("disabled"),i.attr("required",!0),i.attr("data-required",!0)),i.hasClass("boostrap-select-custom")&&i.selectpicker("refresh")}};n(e,!1);for(var i=0;i<o;i++){n($(t[i]),!0)}})},loadCalendarDates:function(a){a&&axios.get(a).then(function(a){a=a.data,AgendaCtrl.setupCalendar(a)})},setupCalendar:function(a){Plugins.loadLibCalendar(function(){$(".loader-calendar").addClass("hide"),$("#service-calendar").fullCalendar({defaultView:"month",monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],header:{left:"title",right:"today prev,next"},buttonText:{today:"Hoje"},events:a,eventRender:AgendaCtrl.onRenderDateCalendar,eventClick:AgendaCtrl.onClickDateCalendar})})},setupDatePickers:function(){Plugins.loadLibDateRanger(function(){for(var a={minDate:new Date,singleDatePicker:!0,autoUpdateInput:!1,locale:{format:"DD/MM/YYYY",daysOfWeek:["Do","2º","3º","4º","5º","6º","Sá"],monthNames:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]}},e=$(".datepicker"),t=e.length,o=0;o<t;o++)!function(t){var o=$(e[t]),n=$(o.attr("data-range"));o.daterangepicker(a),n.daterangepicker(a),o.on("apply.daterangepicker",function(e,t){$(e.currentTarget).val(t.startDate.format(a.locale.format)),n.data("daterangepicker").setMinDate(t.startDate)}),n.on("apply.daterangepicker",function(e,t){$(e.currentTarget).val(t.startDate.format(a.locale.format)),o.data("daterangepicker").setMaxDate(t.startDate)})}(o)})},onChangeSelectEditDates:function(){$("select#select_edit_option").on("change",function(a){var e=$(a.currentTarget),t=$("[data-option='"+e.val()+"']"),o=$(".fields-edit .field").not(t);o.find("input").removeAttr("required").removeAttr("data-required").attr("disabled",!0),o.addClass("hide"),t.find("input").removeAttr("disabled").attr("required",!0).attr("data-required",!0),t.removeClass("hide")})},onRenderDateCalendar:function(a,e,t){var o=t.title.replace(/[0-9]/g,"").trim(),n="<p class='fc-text mt-0'>Consumido <span class=\"pull-right\">"+a.consumido+"</span></p>";n+="<p class='fc-text'>Disponível <span class=\"pull-right\">"+a.disponivel+"</span></p>",n+="<p class='fc-text mt-3'>Tarifa <span class=\"pull-right\">"+a.valor_net+"</span></p>",n+="<p class='fc-info-date'>"+a.title.replace("Data ","")+"</p>",e.find(".fc-content").append(n),o!==a.mes&&e.removeClass("fc-bg-red-cad fc-bg-orange-cad fc-bg-green-cad").addClass("fc-bg-other-month")},onClickDateCalendar:function(a){var e=$("#modal-view-event");App.loader.show(),axios.get(a.view).then(function(a){a=a.data,e.find(".event-title").html(a.title),e.find("#view_date_net").val(a.valor_net),e.find("#view_date_venda").val(a.valor_venda),e.find("#view_date_qtd").val(a.disponivel),e.find("[name='data_id']").val(a.data_id);var t=AgendaCtrl.createHtmlTabs(a.servicos);$(".list-valores-servicos").html(t);var o=$("#data_servicos");o.tab(),o.find("li:first-child a").tab("show"),App.loader.hide(),e.modal()})},createHtmlTabs:function(a){for(var e="<div class='tab-content'>",t=a.length,o='<ul id="data_servicos" class="nav nav-tabs nav-tab-header">',n=0;n<t;n++){for(var i=a[n],r=i.variacoes.length,l="",c=0;c<r;c++){var d=i.variacoes[c];l+="<tr>\n                        <td>"+d.variacao+" <sup>"+d.comissao+'%</small></td>\n                        <td class="text-right">'+d.valor_net+'</td>\n                        <td class="text-right">'+d.valor_venda+"</td>\n                    </tr>"}o+='<li class="nav-item">\n                    <a class="nav-link" data-toggle="tab" href="#serv_'+i.servico_id+'">'+i.nome_tab+"</a>\n                </li>",e+='<div class="tab-pane" id="serv_'+i.servico_id+'">\n                    <div class="servico">\n                        <p class="header-table m-0">'+i.servico+'</p>\n                        <div class="table-responsive">\n                            <table class="table table-border-bottom mb-0">\n                                <thead>\n                                <tr>\n                                    <th class="pt-2 pb-2">Variação</th>\n                                    <th class="pt-2 pb-2 text-right">Tarifa net</th>\n                                    <th class="pt-2 pb-2 text-right">R$ Venda</th>\n                                </tr>\n                                </thead>\n                                <tbody>'+l+"</tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>"}return e+="</div>",o+="</ul>",o+=e}},AvaliacaoStarsCtrl={star0:{},star1:{},star_selecionada_hover:0,star_selecionada:0,init:function(a){AvaliacaoStarsCtrl.onHoverStars(),AvaliacaoStarsCtrl.onClickStar()},onLoadPageStartStars:function(){AvaliacaoStarsCtrl.star_selecionada=$("#star-contador").val(),AvaliacaoStarsCtrl.desenharStarsSelecionada()},onHoverStars:function(){for(var a=1;a<=5;a++)!function(a){$("#star"+a).mouseover(function(){AvaliacaoStarsCtrl.desenharStars(a)}),$("#star"+a).mouseout(function(){AvaliacaoStarsCtrl.desenharStarsSelecionada()})}(a);star0=$("#link-star0").text(),star1=$("#link-star1").text()},clearStars:function(){for(var a=1;a<=5;a++)$("#star"+a).attr("src",star0)},desenharStars:function(a){a<AvaliacaoStarsCtrl.star_selecionada_hover&&AvaliacaoStarsCtrl.clearStars(),AvaliacaoStarsCtrl.star_selecionada_hover=a;for(var e=1;e<=a;e++)$("#star"+e).attr("src",star1)},desenharStarsSelecionada:function(){AvaliacaoStarsCtrl.desenharStars(AvaliacaoStarsCtrl.star_selecionada)},onClickStar:function(){for(var a=1;a<=5;a++)!function(a){$("#star"+a).click(function(){AvaliacaoStarsCtrl.star_selecionada=a,$("#star-contador").val(a)})}(a)}},BannersCtrl={_urlChangeStatus:"",_bannerId:"",init:function(a){void 0!==a.getAttribute("data-banner")&&(this._urlChangeStatus=a.getAttribute("data-route-status"),this._bannerId=a.getAttribute("data-banner")),this.onChangeSelectDestinoIndex(),this.onChangeSelectDestinoLoadServicos(),this.onChangePhoto(),this.onClickButtonActionsBanner(),DestinoCtrl.onClickSearchFile()},onChangeSelectDestinoIndex:function(){$("select#destino_filter").on("change",function(a){var e=$(a.currentTarget),t=e.val(),o=e.attr("data-route");App.loader.show(),window.location.href=o+"/"+t})},onChangeSelectDestinoLoadServicos:function(){$("select#destino_id").on("change",function(a){var e=$(a.currentTarget);BannersCtrl.updateSelectServicos(e.val())}).trigger("change")},updateSelectServicos:function(a){App.loader.show();var e=$("select#servico_id"),t="";$.getJSON(e.attr("data-route")+"/"+a).done(function(a){a.forEach(function(a){t+='<option value="'+a.id+'">'+a.nome+"</option>"}),e.html(t),e.selectpicker("destroy"),e.selectpicker({liveSearch:!0,liveSearchPlaceholder:"Pesquisar serviço"}),App.loader.hide()})},onChangePhoto:function(){$("input[type='file']").on("change",function(a){if(0!==a.currentTarget.files.length){var e=$(a.currentTarget),t=$(e.attr("data-placeholder")),o=$(e.attr("data-name")),n=o.siblings(".invalid-feedback"),i=App.validExtensionFile(a.currentTarget.files[0].name,[".jpg",".jpeg",".png"]),r=a.currentTarget.files[0];if(!App.validMaxSize(r))return swal("A imagem excede os 3MB","A imagem "+r.name+" é maior que 3MB, diminua o peso dela e tente novamente!","error"),!1;if(i){var l=new FileReader;o.val(a.currentTarget.files[0].name),l.onload=function(){t.addClass("loaded"),t.css("background-image","url("+l.result+")")},l.readAsDataURL(a.currentTarget.files[0])}else t.addClass("invalid"),n.html("Não foi possível carregar o arquivo, tente novamente!")}})},onClickButtonActionsBanner:function(){$("[data-buttons-action] button").on("click",function(a){a.preventDefault();var e=$(a.currentTarget);BannersCtrl.sendRequestAlteracaoBanner(e.attr("data-action"))})},sendRequestAlteracaoBanner:function(a){App.loader.show(),axios.put(this._urlChangeStatus,{banner_id:this._bannerId,action:a}).then(App.captureSuccessAjax).catch(App.captureErrorAjax)}},CalculadoraCtrl={init:function(){CalculadoraCtrl.onSubmitFormCalcular()},onSubmitFormCalcular:function(){$("form[name='calcular']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.find("input[name='comissao']").val(),o=e.find("input[name='net_servico']").val(),n=e.find("input[name='net_variacao']").val(),i=e.find("input[name='to']").val();o=o.replace(".","").replace(",","."),n=n.replace(".","").replace(",",".");var r=(n/o*100).toFixed(2),l=(100/(100-t)).toFixed(5);window.opener.ServicoCtrl.recebeValoresCalculadora({encima_net:r,markup:l,acao:i},"*"),window.close()})}},CanalVendaCtrl={init:function(){CanalVendaCtrl.onClickButtonResetCache()},onClickButtonResetCache:function(){$("button[data-action='reset_cache']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t={canal_venda_id:e.attr("data-canal")};App.loader.show(),axios.post(e.attr("data-url"),t).then(function(a){App.loader.hide(),null!==a.data.response?swal("Cache atualizado","O cache foi limpo com sucesso!","success").then(function(){window.location.reload()}):swal("Falha ao limpar o cache","Não foi possível limpar o cache, tente novamente!","error")})})}},CategoriaCtrl={_urlCategoria:"",_dadosCategoria:"",init:function(){CategoriaCtrl.onSubmitFormDescricaoCategoria(),CategoriaCtrl.onSubmitFormCadastroSecaoCategoria(),CategoriaCtrl.onSubmitFormFotosCategoria(),DestinoCtrl.onClickSearchFile(),CategoriaCtrl.onChangePhoto(),CategoriaCtrl.openModalEditSecaoCategoria(),CategoriaCtrl.onClickButtonDeleteSecao()},onSubmitFormDescricaoCategoria:function(){$("form[name='descricao']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action?(CategoriaCtrl._urlCategoria=a.data.view,CategoriaCtrl._dadosCategoria=a.data.categoria,$("input.callback_categoria_id").val(a.data.categoria.id),swal("Categoria cadastrada","A categoria "+a.data.categoria.nome+" foi cadastrada com sucesso!","success").then(function(){CategoriaCtrl.nextTab(2)})):swal("Categoria não cadastrada","Não foi possível cadastrar a categoria, tente novamente!","error")}).catch(function(a){App.captureErrorAjax(a)}))})},onSubmitFormCadastroSecaoCategoria:function(){$("form[name='new_secao_categoria']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action.result?($("#new-secao-categoria").modal("hide"),swal(a.data.action.title,a.data.action.message,"success").then(function(){CategoriaCtrl.nextTab(3)})):swal(a.data.action.title,a.data.action.message,"error")}).catch(function(a){App.captureErrorAjax(a)}))})},onSubmitFormFotosCategoria:function(){$("form[name='fotos_categoria']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget),t=new FormData(e[0]);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),t).then(function(a){App.loader.hide(),a.data.action?swal("Foto cadastrada","As fotos da categoria foram cadastradas com sucesso!","success").then(function(){App.loader.show(),window.location.href=CategoriaCtrl._urlCategoria}):swal("Foto não cadastrada",a.data.message,"error")}).catch(function(a){App.captureErrorAjax(a)}))})},onChangePhoto:function(){$("input[type='file']").on("change",function(a){if(0!==a.currentTarget.files.length){var e=$(a.currentTarget),t=$(e.attr("data-placeholder")),o=$(e.attr("data-name")),n=o.siblings(".invalid-feedback"),i=App.validExtensionFile(a.currentTarget.files[0].name,[".jpg",".jpeg",".png"]),r=a.currentTarget.files[0];if(!App.validMaxSize(r))return swal("A imagem excede os 3MB","A imagem "+r.name+" é maior que 3MB, diminua o peso dela e tente novamente!","error"),!1;if(i){var l=new FileReader;o.val(a.currentTarget.files[0].name),l.onload=function(){t.addClass("loaded"),t.css("background-image","url("+l.result+")")},l.readAsDataURL(a.currentTarget.files[0])}else t.addClass("invalid"),n.html("Não foi possível carregar o arquivo, tente novamente!")}})},nextTab:function(a){for(var e=$("ul#tab_categoria li a"),t=e.length,o=0;o<t;o++){var n=$(e[o]);n.removeClass("active").addClass("disabled"),o+1===a&&n.removeClass("disabled").click()}},openModalEditSecaoCategoria:function(){$(".actions a[data-action='edit-secao']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){App.loader.hide(),void 0!==a.data.id?($("input[name='secao_id']").val(a.data.id),$("input#nome_edit_secao").val(a.data.nome),$("input[name='delete_secao']").val("off"),$("#edit-secao-categoria").modal("show")):swal("Seção não encontrada","Não foi possível localizar a seção, tente novamente!","error").then(function(){$("#edit-secao-categoria").modal("hide")})})})},onClickButtonDeleteSecao:function(){$("button[data-action='delete']").on("click",function(a){a.preventDefault();var e=$("input[name='delete_secao']");e.val("on"),e.parents("form").trigger("submit")})}},ClientesCtrl={init:function(){ClientesCtrl.searchCliente(),ClientesCtrl.onClickButtonDesativarCliente(),ClientesCtrl.onClickButtonAtivarCliente(),ClientesCtrl.onClickButtonResetarSenha()},searchCliente:function(){var a="",e=$(".start-result"),t=$(".not-result"),o=$(".list-results");$("#search-cliente input").on("keyup",function(n){clearTimeout(a),a=setTimeout(function(){var a=$(n.currentTarget),i=a.val().trim(),r="";i.length>0?axios.get(a.attr("data-route")+"?q="+i).then(function(a){var n=a.data.clientes||[],i=a.data.pedidos||[],l=0;n.length&&(l=n.length,r=ClientesCtrl.createListResultClientes(n,a.data.view)),i.length&&(l=i.length,r=ClientesCtrl.createListResultPedidos(i,a.data.view)),e.addClass("hide"),0===l?(t.removeClass("hide"),o.html("")):""!==r&&(t.addClass("hide"),o.html(r))}):(o.html(""),t.addClass("hide"),e.removeClass("hide"))},500)})},createListResultClientes:function(a,e){for(var t="",o=a.length,n=0;n<o;n++){var i=a[n];t+='<li class="list-group-item lista-cliente-resultado">\n                    <a href="'+e+"/"+i.id+'" title="Ver cliente" target="_blank" class="d-block">\n                        <div class="other-message">\n                            <div class="media">\n                                <div class="media-left align-self-center mr-3">\n                                    <div class="media-letter medium">'+i.nome.charAt(0)+'</div>\n                                </div>\n                                <div class="media-body align-self-center">\n                                    <div class="other-message-sender">'+i.nome+'</div>\n                                    <div class="other-message-time">'+i.email+'</div>\n                                </div>\n                                <div class="media-right align-self-center">\n                                    <i class="la la-edit"></i>\n                                </div>\n                            </div>\n                        </div>\n                    </a>\n                </li>'}return t},createListResultPedidos:function(a,e){for(var t="",o=a.length,n=0;n<o;n++){var i=a[n],r=i.pedido||i,l=window.App.formataValor(parseFloat(r.valor_total)+parseFloat(r.juros),2);t+='<li class="list-group-item lista-cliente-resultado">\n                    <a href="'+e+"/"+r.codigo+'" title="Ver pedido" target="_blank" class="d-block">\n                        <div class="other-message">\n                            <div class="media">\n                                <div class="media-left align-self-center mr-3">\n                                    <div class="media-letter medium">'+r.codigo.charAt(0)+'</div>\n                                </div>\n                                <div class="media-body align-self-center">\n                                    <div class="other-message-sender">Pedido #'+r.codigo+'</div>\n                                    <div class="other-message-time">R$ '+l+'</div>\n                                </div>\n                                <div class="media-right align-self-center">\n                                    <i class="la la-file-text-o"></i>\n                                </div>\n                            </div>\n                        </div>\n                    </a>\n                </li>'}return t},onClickButtonDesativarCliente:function(){$("[data-action='desativar_cliente']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=$("input#nome"),o=e.attr("data-route"),n=e.attr("data-id");swal({title:"Deseja desativar este cliente?",text:"O cliente "+t.val()+" será desativado.",icon:"warning",dangerMode:!0,buttons:["Fechar","Sim, desativar"]}).then(function(a){a&&(App.loader.show(),axios.post(o,{cliente_id:n,_method:"DELETE"}).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")}))})})},onClickButtonAtivarCliente:function(){$("[data-action='reativar_cliente']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("data-route"),o=e.attr("data-id");App.loader.show(),axios.put(t,{cliente_id:o}).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")})})},onClickButtonResetarSenha:function(){$("[data-action='resetar_senha']").on("click",function(a){a.preventDefault();var e=a.currentTarget,t=e.getAttribute("data-route"),o=e.getAttribute("data-id");swal({title:"Gerar nova senha",text:"Tem certeza que deseja gerar uma nova senha ?",icon:"warning",dangerMode:!0,buttons:["Não","Sim"]}).then(function(a){if(a){App.loader.show();var e={cliente_id:o};axios.post(t,e).then(function(a){var e=a.data;App.loader.hide(),swal({title:"Senha alterada",text:"A senha do cliente foi alterada para "+e.senha,icon:"success"})})}})})}},ColaboradoresCtrl={init:function(){ColaboradoresCtrl.onClickButtonEditColaborador(),ColaboradoresCtrl.onClickButtonDesativarColaborador(),ColaboradoresCtrl.onClickButtonAtivarColaborador()},onClickButtonEditColaborador:function(){$("[data-action='edit-colaborador']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){App.loader.hide(),a=a.data;var e=$("#edit-colaborador"),t=$("select#edit_level");e.find("form").trigger("reset"),e.find("input[type='checkbox']").attr("checked",!1),t.find("option").removeAttr("selected"),e.find("#edit_name").val(a.name),e.find("#edit_email").val(a.email),e.find("input[name='colaborador_id']").val(a.id),t.find("[data-nivel='"+a.level+"']").attr("selected",!0),t.selectpicker("refresh"),e.modal("show")})})},onClickButtonDesativarColaborador:function(){$("button[data-action='desativar']").on("click",function(a){a.preventDefault();var e=$("input[name='desativar_colaborador']");e.val("on"),e.parents("form").trigger("submit")})},onClickButtonAtivarColaborador:function(){$("[data-action='activate-colaborador']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href"),o=e.attr("data-id");App.loader.show(),axios.put(t,{colaborador:o}).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")})})}},ComissoesTerminalCtrl={init:function(){ComissoesTerminalCtrl.onClickButtonMakePayment(),ComissoesTerminalCtrl.onClickButtonDetailPayment()},onClickButtonMakePayment:function(){$("[data-action='makePayment']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=$("#view-pagamento"),o=e.attr("href");window.App.loader.show(),axios.get(o).then(function(a){window.App.loader.hide();var e=window.App.formataValor(a.data.total_comissao,2);t.find("#nome_terminal").html(a.data.terminal.nome),t.find("#valor_comissao").html("R$ "+e),t.find("[name='pagamento_id']").val(a.data.id),t.find("[name='valor_pago']").val(e),t.modal("show")})})},onClickButtonDetailPayment:function(){$("[data-action='detailPayment']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=$("#detalhe-pagamento"),o=e.attr("href");window.App.loader.show(),axios.get(o).then(function(a){window.App.loader.hide();var e=window.App.formataValor(a.data.total_comissao,2),o=window.App.formataValor(a.data.total_pago,2),n=a.data.data_pagamento.split(" "),i=n[0].split("-");t.find("#nome_terminal_detalhes").html(a.data.terminal.nome),t.find("#valor_comissao_detalhes").html("R$ "+e),t.find("#valor_pago_detalhes").html("R$ "+o),t.find("#data_pagamento_detalhes").html(i[2]+"/"+i[1]+"/"+i[0]+" "+n[1].substr(0,5)),t.modal("show")})})}},DashboardCtrl={_dadosChart:[],init:function(){DashboardCtrl.setupChartJs()},setupChartJs:function(){Plugins.loadChartJs(function(){DashboardCtrl._dadosChart=window.dados_chart;var a=window.label_chart||"Valor vendido + Juros (R$)",e=$("#line-chart-01")[0].getContext("2d");new Chart(e,{type:"line",data:{labels:DashboardCtrl._dadosChart.labels,datasets:[{label:a,borderColor:"#5d5386",pointBackgroundColor:"#5d5386",pointHoverBorderColor:"#5d5386",pointHoverBackgroundColor:"#5d5386",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:5,fill:!0,backgroundColor:"rgba(93, 83, 134, 0.6)",borderWidth:3,data:DashboardCtrl._dadosChart.data_set}]},options:{maintainAspectRatio:!1,legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}]},tooltips:{mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.8)",titleFontSize:14,titleFontColor:"#fff",bodyFontColor:"#fff",caretSize:12,xPadding:12,displayColors:!1,yPadding:12,callbacks:{title:function(a){var e=DashboardCtrl._dadosChart.dados[a[0].index];return e.semana+" - "+e.dia+" de "+e.mes}}}}})})}},DestinoCtrl={_urlDestino:"",_dadosDestino:"",_secaoServicos:[],_secaoAtual:[],init:function(){DestinoCtrl.onSubmitFormDescricaoDestino(),DestinoCtrl.onSubmitFormFotoDestino(),DestinoCtrl.onClickSearchFile(),DestinoCtrl.onChangePhoto(),DestinoCtrl.onClickButtonEditSecao(),DestinoCtrl.onClickButtonAtivarSecao(),DestinoCtrl.onKeyUpInputSearch(),DestinoCtrl.onClickButtonNovaSecao(),DestinoCtrl.onClickButtonRemoveSecao(),DestinoCtrl.onChangeCheckboxServicos(),DestinoCtrl.onClickButtonRemoveServico()},onSubmitFormDescricaoDestino:function(){$("form[name='descricao']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action?(DestinoCtrl._urlDestino=a.data.view,DestinoCtrl._dadosDestino=a.data.destino,$("input.callback_destino_id").val(a.data.destino.id),swal("Destino cadastrado","O destino "+a.data.destino.nome+" foi cadastrado com sucesso!","success").then(function(){DestinoCtrl.nextTab(2)})):swal("Destino não cadastrado","Não foi possível cadastrar o destino, tente novamente!","error")}).catch(function(a){App.captureErrorAjax(a)}))})},onSubmitFormFotoDestino:function(){$("form[name='foto-destino']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget),t=new FormData(e[0]);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),t).then(function(a){App.loader.hide(),a.data.action?swal("Foto cadastrada","A foto do destino foi cadastrada com sucesso!","success").then(function(){App.loader.show(),window.location.href=DestinoCtrl._urlDestino}):swal("Foto não cadastrada",a.data.message,"error")}).catch(function(a){App.captureErrorAjax(a)}))})},onClickSearchFile:function(){$(".open-search-file").on("click",function(a){var e=$(a.currentTarget);$(e.attr("data-callback")).click()})},onChangePhoto:function(){$("input[name='foto']").on("change",function(a){if(0!==a.currentTarget.files.length){var e=$("input[name='placeholder']"),t=e.siblings(".invalid-feedback"),o=App.validExtensionFile(a.currentTarget.files[0].name,[".jpg",".jpeg",".png"]),n=a.currentTarget.files[0];if(!App.validMaxSize(n))return swal("A imagem excede os 3MB","A imagem "+n.name+" é maior que 3MB, diminua o peso dela e tente novamente!","error"),!1;if(o){var i=new FileReader;e.val(a.currentTarget.files[0].name),i.onload=function(){var a=$("#place-foto");a.addClass("loaded"),a.css("background-image","url("+i.result+")")},i.readAsDataURL(a.currentTarget.files[0])}else e.addClass("invalid"),t.html("Não foi possível carregar o arquivo, tente novamente!")}})},nextTab:function(a){for(var e=$("ul#tab_destino li a"),t=e.length,o=0;o<t;o++){var n=$(e[o]);n.removeClass("active").addClass("disabled"),o+1===a&&n.removeClass("disabled").click()}},onKeyUpInputSearch:function(){$("input.search-on-list").on("keyup",function(a){for(var e=$(a.currentTarget),t=$(e.attr("data-target")),o=t.find("li"),n=o.length,i=Plugins.removerAcentos(e.val().trim().toLowerCase()),r=0;r<n;r++){var l=$(o[r]),c=Plugins.removerAcentos(l.find("[data-nome]").text().toLowerCase());c+=" "+Plugins.removerAcentos(l.find("[data-fornecedor]").text().toLowerCase()),c.indexOf(i)>-1?l.removeClass("d-none"):l.addClass("d-none")}})},onDragListSelecionados:function(a){function e(a){l=this,a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/html",this.outerHTML),this.classList.add("dragElem")}function t(a){return a.preventDefault&&a.preventDefault(),this.classList.add("over"),a.dataTransfer.dropEffect="move",!1}function o(a){this.classList.remove("over")}function n(a){if(a.stopPropagation&&a.stopPropagation(),l!==this){this.parentNode.removeChild(l);var e=a.dataTransfer.getData("text/html");this.insertAdjacentHTML("beforebegin",e);r(this.previousSibling)}return this.classList.remove("over"),DestinoCtrl.reordernarSelecionados(c),!1}function i(a){$(a.currentTarget).removeClass("over dragElem")}function r(a){a.addEventListener("dragstart",e,!1),a.addEventListener("dragover",t,!1),a.addEventListener("dragleave",o,!1),a.addEventListener("drop",n,!1),a.addEventListener("dragend",i,!1)}for(var l=null,c="cadastro"===a?$("#cadastro-selecionados"):$("#editar-selecionados"),d=c.find("li"),s=d.length,u=0;u<s;u++)r(d[u])},reordernarSelecionados:function(a){a=a.find("li");for(var e=[],t=a.length,o=0;o<t;o++){var n=$(a[o]),i=parseInt(n.find("input[data-servico]").val()),r=o+1;e.push({id:i,nome:n.find("[data-nome]").text(),fornecedor:n.find("[data-fornecedor]").text()}),n.find("[data-ordem]").html(r),n.find("input[data-posicao]").val(r),n.removeClass("dragElem")}DestinoCtrl._secaoServicos=e},onChangeCheckboxServicos:function(){$(".grid-servicos input[type='checkbox']").on("change",function(a){var e=$(a.currentTarget),t=e.parents("li"),o=e.attr("data-action"),n=parseInt(e.val());if(e.prop("checked")){if(10===DestinoCtrl._secaoServicos.length)return swal("Máximo 10 serviços","Você pode selecionar no máximo 10 serviços por seção!","error"),e.prop("checked",!1),!1;DestinoCtrl._secaoServicos.push({id:n,nome:t.find("[data-nome]").text(),fornecedor:t.find("[data-fornecedor]").text()})}else DestinoCtrl.removeServicoSelecionado(n);DestinoCtrl.updateListServicoSelecionados(o)})},updateListServicoSelecionados:function(a){for(var e=DestinoCtrl._secaoServicos.length,t="",o="cadastro"===a?$("#cadastro-selecionados"):$("#editar-selecionados"),n=0;n<e;n++){var i=DestinoCtrl._secaoServicos[n],r=n+1;t+='<li draggable="true">\n                    <div class="row">\n                        <div class="col-10 text-truncate">\n                            <strong data-ordem>'+r+'</strong> -\n                            <strong data-nome class="text-truncate">'+i.nome+'</strong>\n                            <small data-fornecedor class="text-truncate">'+i.fornecedor+'</small>\n                        </div>\n                        <div class="col-2 d-flex align-items-center no-padding-left">\n                            <button type="button" class="btn-remove-servico" title="Remover serviço" data-action="'+a+'" data-servico="'+i.id+'">\n                                <i class="la la-trash text-danger"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <input type="hidden" data-servico name="servicos['+r+'][id]" value="'+i.id+'">\n                    <input type="hidden" data-posicao name="servicos['+r+'][ordem]" value="'+r+'">\n                </li>'}o.html(t),DestinoCtrl.onDragListSelecionados(a)},removeServicoSelecionado:function(a){for(var e=DestinoCtrl._secaoServicos.length,t=0;t<e;t++)if(DestinoCtrl._secaoServicos[t].id===a){DestinoCtrl._secaoServicos.splice(t,1);break}},onClickButtonRemoveServico:function(){$(document).on("click","button.btn-remove-servico",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("data-action"),o=parseInt(e.attr("data-servico"));DestinoCtrl.removeServicoSelecionado(o),DestinoCtrl.updateListServicoSelecionados(t),$("[data-action='"+t+"'][value='"+o+"']").prop("checked",!1)})},onClickButtonNovaSecao:function(){$("button[data-target='#new-secao-destino']").on("click",function(a){DestinoCtrl._secaoServicos=[],$("input[data-action='cadastro']").prop("checked",!1)})},onClickButtonEditSecao:function(){var a=$("#edit-secao-destino"),e=$("select#tipo_edit_secao");$("[data-action='edit-secao']").on("click",function(t){t.preventDefault();var o=$(t.currentTarget);DestinoCtrl._secaoServicos=[],$("input[data-action='editar']").prop("checked",!1),App.loader.show(),axios.get(o.attr("href")).then(function(t){t=t.data,DestinoCtrl._secaoAtual=t,a.find("form").trigger("reset"),e.find("option").removeAttr("selected"),a.find("input#titulo_edit_secao").val(t.titulo),a.find("input#ordem_edit_secao").val(t.ordem),a.find("input#descricao_edit_secao").val(t.descricao),a.find("input[name='home_destino_id']").val(t.id),e.find("option[value='"+t.tipo+"']").attr("selected",!0),e.selectpicker("refresh");for(var o=t.servicos,n=o.length,i=0;i<n;i++){var r=o[i];DestinoCtrl._secaoServicos.push({id:parseInt(r.id),nome:r.nome,fornecedor:r.fornecedor.nome_fantasia}),$("input[data-action='editar'][value="+r.id+"]").prop("checked",!0)}DestinoCtrl.updateListServicoSelecionados("editar"),App.loader.hide(),a.modal()})})},onClickButtonRemoveSecao:function(){
$("button[data-action='delete']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("data-route");App.loader.show(),axios.post(t,{home_destino_id:DestinoCtrl._secaoAtual.id,_method:"DELETE"}).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")})})},onClickButtonAtivarSecao:function(){$("a[data-action='ativar-secao']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget);App.loader.show(),axios.put(e.attr("href"),{home_destino_id:e.attr("data-id")}).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")})})}},FornecedorCtrl={_urlCNPJ:"",_urlParceiro:"",_dadosParceiro:"",init:function(a){FornecedorCtrl.onBlurInputCNPJ(),FornecedorCtrl.onSubmitFormFichaCadastro(),FornecedorCtrl.onSubmitFormDadosFinanceiros(),FornecedorCtrl.onSubmitFormRegrasTermos(),FornecedorCtrl.onClickButtonEditSplit(),FornecedorCtrl.onClickButtonEditUser(),FornecedorCtrl.onClickButtonDesativarUsuario(),FornecedorCtrl.onClickButtonAtivarUsuario(),FornecedorCtrl._urlCNPJ=a.getAttribute("data-cnpj")},onBlurInputCNPJ:function(){$("input.search_cnpj").blur(function(a){var e=$(a.currentTarget),t=e.val().trim().replace(/\D/g,""),o=e.next(".invalid-feedback");if(14===t.length){var n=App.noty.warning("Buscando informações sobre o CNPJ, aguarde..."),i=axios.get(FornecedorCtrl._urlCNPJ+"/"+t);i.then(function(a){if(n.close(),200===a.status){var t=a.data;void 0!==a.data.has_cnpj?(e.addClass("invalid"),o.html("Este CNPJ já está em uso."),App.noty.error("Este CNPJ já está em uso")):void 0!==t.fantasia?($("[name='razao_social']").val(t.nome.toLowerCase()).trigger("keyup"),$("[name='nome_fantasia']").val(t.fantasia.toLowerCase()).trigger("keyup"),$("[name='cep']").val(t.cep.replace(".","")),$("[name='endereco']").val(t.logradouro.toLowerCase()+", "+t.numero.toLowerCase()).trigger("keyup"),$("[name='bairro']").val(t.bairro.toLowerCase()).trigger("keyup"),$("[name='cidade']").val(t.municipio.toLowerCase()).trigger("keyup"),$("[name='estado']").val(App.estados[t.uf.toUpperCase()]).trigger("keyup"),$("[name='emails']").val(t.email.toLowerCase()),$("[name='phone']").val(t.telefone.toLowerCase()),App.noty.sucesso("Dados preenchidos :)")):App.noty.error("Não encontramos nada para este CNPJ")}else App.noty.error("Não encontramos nada para este CNPJ")}),i.catch(function(){App.noty.error("Não encontramos nada para este CNPJ")})}else t.length>0&&t.length<14&&(e.addClass("invalid"),o.html("O CNPJ deve conter 14 caracteres."))})},onSubmitFormFichaCadastro:function(){$("form[name='ficha-cadastro']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action?(FornecedorCtrl._urlParceiro=a.data.view,FornecedorCtrl._dadosParceiro=a.data.partner,$("input.callback_fornecedor_id").val(a.data.partner.id),swal("Fornecedor cadastrado","O fornecedor "+a.data.partner.nome_fantasia+" foi cadastrado com sucesso!","success").then(function(){FornecedorCtrl.nextTab(2)})):swal("Fornecedor não cadastrado","Não foi possível cadastrar o fornecedor, tente novamente!","error")}).catch(function(a){App.captureErrorAjax(a)}))})},onSubmitFormDadosFinanceiros:function(){$("form[name='financeiro-cadastro']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action?swal("Dados cadastrados","O dados bancários foram salvos com sucesso!","success").then(function(){FornecedorCtrl.nextTab(3)}):swal("Dados não cadastrados","Não foi possível salvar os dados bancários, tente novamente!","error")}).catch(function(a){App.captureErrorAjax(a)}))})},onSubmitFormRegrasTermos:function(){$("form[name='regras-cadastro']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action?swal("Regras e termos cadastrados","As regras e termos foram salvas com sucesso!","success").then(function(){App.loader.show(),window.location.href=FornecedorCtrl._urlParceiro}):swal("Regras não cadastrados","Não foi possível salvar as regras e termos, tente novamente!","error")}).catch(function(a){App.captureErrorAjax(a)}))})},onClickButtonEditSplit:function(){$("[data-action='edit-split']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){App.loader.hide(),a=a.data,void 0!==a.id?($("input#canal_venda_id_edit").val(a.canal_venda.site),$("input#token_edit").val(a.token),$("input[name='split_pagamento_id']").val(a.id),$("#edit-split").modal("show")):swal("Falha ao recuperar os dados","Não foi possível localizar os dados do split, tente novamente!","error")})})},onClickButtonEditUser:function(){$("[data-action='edit-user']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){App.loader.hide(),a=a.data;var e=$("#edit-user"),t=$("select#level-edit");e.find("form").trigger("reset"),t.find("option").removeAttr("selected"),e.find("#nome-edit").val(a.nome),e.find("#email-edit").val(a.email),e.find("input[name='usuario_id']").val(a.id),t.find("[value='"+a.level+"']").attr("selected",!0),t.selectpicker("refresh"),e.modal("show")})})},onClickButtonDesativarUsuario:function(){$("button[data-action='desativar']").on("click",function(a){a.preventDefault();var e=$("input[name='desativar_usuario']");e.val("on"),e.parents("form").trigger("submit")})},onClickButtonAtivarUsuario:function(){$("[data-action='activate-user']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href"),o=e.attr("data-id");App.loader.show(),axios.put(t,{usuario:o}).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")})})},nextTab:function(a){for(var e=$("ul#tab_fornecedor li a"),t=e.length,o=0;o<t;o++){var n=$(e[o]);n.removeClass("active").addClass("disabled"),o+1===a&&n.removeClass("disabled").click()}}},NavbarCtrl={_cookie:"menu_sidebar",init:function(){NavbarCtrl.onClickToggleMenu(),NavbarCtrl.onClickLogout();var a="close";window.innerWidth>1024&&(a=App.cookie.read(NavbarCtrl._cookie)||"close"),"open"===a&&NavbarCtrl.openSidebar(),NavbarCtrl.selectCanalDeVenda(),NavbarCtrl.onClickBotaoPedidosPendentes()},onClickToggleMenu:function(){$("nav a#toggle-btn").on("click",function(a){a.preventDefault(),"false"===$(a.currentTarget).attr("data-sidebar")?NavbarCtrl.openSidebar():NavbarCtrl.closeSidebar()})},openSidebar:function(){$(".compact-light-sidebar").addClass("active"),$("#content-inner").removeClass("compact"),$("nav a#toggle-btn").addClass("active").attr("data-sidebar",!0),App.cookie.create(NavbarCtrl._cookie,"open",5)},closeSidebar:function(){$(".compact-light-sidebar").removeClass("active"),$("#content-inner").addClass("compact"),$("nav a#toggle-btn").removeClass("active").attr("data-sidebar",!1),App.cookie.create(NavbarCtrl._cookie,"close",5)},onClickLogout:function(){$("nav a#logout").on("click",function(a){a.preventDefault();var e=$(a.currentTarget);App.loader.show(),axios.post(e.attr("href")).then(function(a){window.location.replace(a.data.url)})})},selectCanalDeVenda:function(){var a=$("select.select_navbar");a.selectpicker({liveSearch:!0,liveSearchPlaceholder:"Procurar canal de venda"}),a.on("change",function(a){var e=$(a.currentTarget),t=e.val();App.loader.show(),axios.post(e.attr("data-url"),{canal_id:t}).then(function(a){a.data.action?location.reload():(App.loader.hide(),swal("Op's ocorreu um erro!","Não foi possível alterar o canal, tente novamente!.","error"))})})},onClickBotaoPedidosPendentes:function(){$("#sino_pedidos_pendentes").on("click",function(){App.loader.show();var a=$("#link_atualizar_pedidos").attr("data");axios.post(a,{}).then(function(a){App.loader.hide();var e=a.data,t=e.pagos,o=e.pendentes,n=e.expirados,i=t+o+n;swal("Avaliado(s) "+i+" pedido(s) por PIX",o+" pedidos continuam pendentes\n"+n+" pedidos expiraram\n"+t+" pedidos foram pagos","success").then(function(){(t>0||n>0)&&window.location.reload()})})})}},RelatorioAutenticadoCtrl={init:function(){}},RelatorioFornecedorCtrl={init:function(){RelatorioFornecedorCtrl.createCheckboxFiltroAutenticados()},createCheckboxFiltroAutenticados:function(){$("#filtro-periodo-modal").find(".col-xl-12.mb-2").append('<div class="mt-4">\n                <label for="fornecedor_filtro_relatorio" class="form-control-label">Tipo de data</label>\n                <div class="input-group">\n                    <span class="input-group-addon addon-secondary left"><i class="la la-suitcase"></i></span>\n                    <select id="afiliado_filtro_relatorio" name="tipo_data" class="form-control boostrap-select-custom" required data-required title="Selecione um tipo de data">\n                        <option value="VENDA">Data da Venda</option>\n                        <option value="UTILIZACAO">Data da Utilização</option>\n                    </select>\n                    <div class="invalid-feedback"></div>\n                </div>\n                <br>\n                <div class="styled-checkbox">\n                    <input type="checkbox" name="autenticados" id="filtro-autenticado" value="true">\n                    <label for="filtro-autenticado">Somente ingressos autenticados</label>\n                </div>\n            </div>')}},ReservaCtrl={_disponibilidade:[],_events:[],_quantideAtualReserva:0,finalizacao:{data:[],acompanhantes:[],campos_adicionais_lista:[]},init:function(a){Plugins.loadLibDateRanger(),ReservaCtrl.onClickButtonRemoveAcompanhante(),ReservaCtrl.onClickButtonAlterarAgenda(),ReservaCtrl.onClickButtonEditQuantidade(),ReservaCtrl.disableActionsReserva(a),ReservaCtrl.onClickButtonPrint(),ReservaCtrl.onClickBotaoFinalizar(),ReservaCtrl.onClickBotaoFinalizarAcomps(),ReservaCtrl.onClickBotaoFinalizarCampos(),ReservaCtrl.forcarIntegracao()},onClickButtonPrint:function(){$("button[data-action='print_voucher']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget);window.open(e.attr("data-url"),"_blank")})},disableActionsReserva:function(a){if("1"===a.getAttribute("data-disabled")){$(".disable-action").addClass("disabled").attr("disabled",!0)}},onClickButtonEditQuantidade:function(){$("button[data-action='edit_quantidade']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget);App.loader.show(),axios.get(e.attr("data-route")).then(function(a){var e=$("#edit-quantidade-reserva"),t="<option selected disabled>Selecione a nova quantidade</option>",o=parseInt(a.data.quantidade);if(o>=1){ReservaCtrl._quantideAtualReserva=o,e.find("#quantidade_atual").val(o+"x "+a.data.variacao_servico.nome);for(var n=o-1;n>=0;n--)t+=n>0?'<option value="'+n+'">'+n+"x "+a.data.variacao_servico.nome+"</option>":'<option value="'+n+'">Remover '+a.data.variacao_servico.nome+"</option>";e.find("#nova_quantidade").html(t),e.find("input[name='quantidade_reserva_id']").val(a.data.id),App.loader.hide(),e.modal("show")}else App.loader.hide(),swal("Não é possível alterar","A variação atual possui somente 1 (uma) quantidade","error")})})},onClickButtonRemoveAcompanhante:function(){$("button[data-action='delete_acompanhante']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=$("#nome_acop_"+e.attr("data-index"));swal({title:"Deseja remover este acompanhante?",text:t.val()+" será removido da reserva! Não será possível desfazer essa ação.",icon:"warning",dangerMode:!0,buttons:["Fechar","Sim, remover"]}).then(function(a){if(a){App.loader.show();var t={acompanhante_id:e.attr("data-id"),_method:"DELETE"};axios.post(e.attr("data-url"),t).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")})}})})},onClickButtonAlterarAgenda:function(){$("button[data-action='alterar_agenda']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=$("#edit-agenda-reserva");App.loader.show(),axios.get(e.attr("data-url")).then(function(a){ReservaCtrl._events=a.data.events,ReservaCtrl._disponibilidade=a.data.disponibilidade,t.find("#data_atual").val(a.data.data_atual),t.find("#qtd_pessoas").val(a.data.quantidade+" pessoas");var e=t.find("#new_date");e.val(""),e.daterangepicker({minDate:ReservaCtrl.dataToIE(a.data.events[0].date),singleDatePicker:!0,autoUpdateInput:!1,isCustomDate:ReservaCtrl.filterDateCalendar,locale:{format:"DD/MM/YYYY",daysOfWeek:["Do","2º","3º","4º","5º","6º","Sá"],monthNames:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]}}),e.on("apply.daterangepicker",ReservaCtrl.onSelectDateCalendar),App.loader.hide(),t.modal("show")})})},onSelectDateCalendar:function(a,e){var t="";$(a.currentTarget).val(e.startDate.format("DD/MM/YYYY"));for(var o=e.startDate.format("YYYY-MM-DD"),n=ReservaCtrl._disponibilidade.length,i=0;i<n;i++){var r=ReservaCtrl._disponibilidade[i];r.data===o&&(t=r.data_servico_id)}$("input[name='data_agenda_id']").val(t)},filterDateCalendar:function(a){for(var e=ReservaCtrl._events.length,t=a.format("YYYY-MM-DD")+" 00:00:00",o=0;o<e;o++){if(ReservaCtrl._events[o].date===t)return""}return"disabled"},dataToIE:function(a){var e=a.split(" ");return e=e[0].split("-"),new Date(e[0],e[1]-1,e[2],0,0,0,0)},onClickBotaoFinalizar:function(){$("#finalizar-reserva-botao").on("click",function(a){ReservaCtrl.modalAcomps()})},onClickBotaoFinalizarAcomps:function(){$("#salvar-acompanhantes").on("click",function(a){ReservaCtrl.salvarAcomps()})},onClickBotaoFinalizarCampos:function(){$("#salvar-campos").on("click",function(a){ReservaCtrl.salvarCampos()})},modalAcomps:function(a){var e=$("#finalizar-reserva-botao").attr("reserva_id"),t=$("#link-finalizacao").text(),o=t+"?reserva_id="+e;axios.get(o).then(function(a){var e=a.data;ReservaCtrl.finalizacao.data=e,ReservaCtrl.abrirModalAcomps(e.quantidades)})},abrirModalAcomps:function(a){if("SOLICITA_INFO_CLIENTES"!=ReservaCtrl.finalizacao.data.servico.info_clientes)return void ReservaCtrl.changeAcompToCampoToFinish();for(var e=$("#modal-acompanhantes"),t=0,o="",n=0;n<a.length;n++)for(var i=a[n],r=0;r<i.quantidade;r++)o+='\n                        <div class="list-acompanhantes mb-2">\n                            <h6 class="font-weight-medium h5" style="font-weight: bold;">'+(t+1)+"° Acompanhante - "+i.variacao_servico.nome+'</h6>\n                            <div class="row">\n                                <div class="form-group nome_acompanhante col-sm-12 col-lg-4">\n                                    <label for="nome_'+n+'" style="color:#2c304d;">Nome completo*</label>\n                                    <input type="text" class="form-control" id="nome_'+t+'" name="acompanhantes['+t+'][nome]" data-auto-capitalize data-nome-completo="true" required data-min="5" data-required placeholder="Nome e sobrenome" autocomplete="off" title="Nome completo" data-list="nomes_acom" data-callback="nome">\n                                    <div class="invalid-feedback"></div>\n                                </div>\n                                <div class="form-group doc_acompanhante col-sm-12 col-md-6 col-lg-4">\n                                    <label for="documento_'+n+'" style="color:#2c304d;">N° do documento*</label>\n                                    <input type="text" class="form-control" id="documento_'+t+'" name="acompanhantes['+t+'][documento]" required data-min="5" data-required placeholder="Número CPF ou RG" title="Documento" autocomplete="off" data-list="doc_acom" data-callback="documento">\n                                    <div class="invalid-feedback"></div>\n                                </div>\n                                <div class="form-group nasc_acompanhante col-sm-12 col-md-6 col-lg-4">\n                                    <label for="nascimento_'+n+'" style="color:#2c304d;">Nascimento*</label>\n                                    <input type="tel" class="form-control vanillaMask" id="nascimento_'+t+'" name="acompanhantes['+t+'][nascimento]" required data-min="9" data-required placeholder="DD/MM/AAAA" data-mask="date" title="Nascimento" autocomplete="off" maxlength="10" autocomplete="off" data-list="data_acom" data-callback="nascimento">\n                                    <div class="invalid-feedback"></div>\n                                    <input type="hidden" id="variacao_'+t+'" name="acompanhantes['+t+'][variacao_servico_id]" value="'+i.variacao_servico_id+'">\n                                    <input type="hidden" id="reserva_'+t+'" name="acompanhantes['+t+'][reserva_pedido_id]" value="'+i.reserva_pedido_id+'">\n                                </div>\n                            </div>\n                        </div>\n                    ',t++,e.find(".fields-input").html(o),App.vanillaMask();e.jqmodal()},salvarAcomps:function(){for(var a=ReservaCtrl.finalizacao.data.quantidades,e=[],t=0,o=0;o<a.length;o++)for(var n=a[o],i=0;i<n.quantidade;i++){var r={};if(r.nome=$("#nome_"+t).val(),0==ReservaCtrl.isNomeOuDocumentoAcompValido(r.nome))return ReservaCtrl.alerta("Nome inválido","O nome do acompanhante "+(t+1)+" deve conter pelo menos 5 caracteres.");if(r.documento=$("#documento_"+t).val(),0==ReservaCtrl.isNomeOuDocumentoAcompValido(r.documento))return ReservaCtrl.alerta("Documento inválido","O documento do acompanhante "+(t+1)+" deve conter pelo menos 5 caracteres.");if(r.nascimento=$("#nascimento_"+t).val(),0==ReservaCtrl.isNascimentoAcompValido(r.nascimento))return ReservaCtrl.alerta("Data de nascimento inválida","A data de nascimento do acompanhante "+(t+1)+" deve ser válida.");r.variacao_servico_id=$("#variacao_"+t).val(),r.reserva_pedido_id=$("#reserva_"+t).val(),e.push(r),t++}ReservaCtrl.finalizacao.acompanhantes=e,ReservaCtrl.changeAcompToCampoToFinish()},changeAcompToCampoToFinish:function(){ReservaCtrl.finalizacao.data.servico.campos_adicionais_ativos.length>0?ReservaCtrl.abrirModalCampo():ReservaCtrl.submeterInformacoes()},abrirModalCampo:function(){for(var a=ReservaCtrl.finalizacao.data.servico.campos_adicionais_ativos,e=$("#modal-campo-adicional"),t="",o=0;o<a.length;o++){var n=a[o],i=0===o?"col-sm-12":"col-sm-12 col-md-6",r="",l="";"SIM"===n.obrigatorio&&(r="data-required required",l="*"),t+='<div class="form-group '+i+'">\n                        <label for="adicional_'+n.id+'" style="color:#2c304d;">'+n.campo+l+'</label>\n                        <input type="text" class="form-control campos" numero="'+o+'" id="adicional_'+n.id+'" name="adicionais['+o+'][informacao]" data-min="1" '+r+' placeholder="'+n.placeholder+'" title="'+n.campo+'">\n                        <span class="invalid-feedback"></span>\n                        <input type="hidden" id="ad-'+o+'" name="adicionais['+o+'][campo_adicional_servico_id]" value="'+n.id+'">\n                        <input type="hidden" id="adr-'+o+'" name="adicionais['+o+'][campo_adicional_servico_id]" value="'+ReservaCtrl.finalizacao.data.reserva.id+'">\n                    </div>',e.find(".fields-input").html(t),e.jqmodal()}},salvarCampos:function(){for(var a=$(".campos"),e=[],t=0;t<a.length;t++){var o={},n=a.eq(t),i=$("#ad-"+n.attr("numero")),r=$("#adr-"+n.attr("numero"));if(o.informacao=n.val(),0==ReservaCtrl.isCampoAdicionalValido(o.informacao))return ReservaCtrl.alerta("Campo adicional inválido","O(s) campo(s) adicionais devem conter pelo menos 4 caracteres.");o.campo_adicional_servico_id=i.val(),o.reserva_pedido_id=r.val(),e.push(o),ReservaCtrl.finalizacao.campos_adicionais_lista=e}ReservaCtrl.submeterInformacoes()},submeterInformacoes:function(){App.loader.show();var a={acompanhantes:ReservaCtrl.finalizacao.acompanhantes,campos_adicionais:ReservaCtrl.finalizacao.campos_adicionais_lista},e=$("#link-finalizacao-store").text();axios.post(e,a).then(function(a){window.location.reload()})},isNomeOuDocumentoAcompValido:function(a){return a.length>4},isNascimentoAcompValido:function(a){return!(10!=a.length||!App.isValidDate(a))},isCampoAdicionalValido:function(a){return a.length>3},alerta:function(a,e){swal(a,e,"warning")},forcarIntegracao:function(){$("#forcar-integracao-btn").on("click",function(){var a=$("#forcar-integracao-btn").attr("reserva_id"),e=$("#forcar-integracao-btn").attr("data-url");swal({title:"Forçar integração",text:"Tem certeza que deseja forçar a integração ? Haverá cobrança do parque!",icon:"warning",dangerMode:!0,buttons:["Não","Sim"]}).then(function(t){if(t){App.loader.show();var o={reserva_id:a};axios.post(e,o).then(function(a){var e=a.data;e.status?(App.loader.hide(),swal({title:"Reserva integrada",text:e.info,icon:"success"}).then(function(){window.location.reload()})):(App.loader.hide(),swal({title:"Erro na integração",text:e.info,icon:"error"}))})}})})}},ServicoCtrl={_urlServico:"",_dadosServico:"",init:function(){ServicoCtrl.onSubmitFormDescricaoServico(),ServicoCtrl.onSubmitFormCadastroCategoriaServico(),ServicoCtrl.onSubmitFormRegrasVoucher(),ServicoCtrl.onSubmitFormCadastroCampoAdicional(),ServicoCtrl.onSubmitFormFotosServico(),ServicoCtrl.onSubmitFormCadastroVariacaoServico(),ServicoCtrl.onClickAdicionarCategoria(),ServicoCtrl.onChangeCategoriaCadastroModal(),DestinoCtrl.onClickSearchFile(),ServicoCtrl.onChangePhoto(),ServicoCtrl.onChangeSelectTipoCorretagem(),ServicoCtrl.onClickButtonProximoPasso(),ServicoCtrl.onClickButtonEditField(),ServicoCtrl.onClickButtonDeleteCampo(),ServicoCtrl.onClickButtonActivateField(),ServicoCtrl.onClickButtonEditPhoto(),ServicoCtrl.onClickButtonDeleteFoto(),ServicoCtrl.onClickButtonEditCategoria(),ServicoCtrl.onClickButtonDeleteCategoria(),ServicoCtrl.onClickButtonEditVariation(),ServicoCtrl.onClickButtonDeleteVariacao(),ServicoCtrl.onClickButtonActivateVariation(),ServicoCtrl.onClickButtonEditComissao(),ServicoCtrl.onClickButtonEditMarkup(),ServicoCtrl.onClickButtonOpenModalTag(),ServicoCtrl.onClickButtonEditTag(),ServicoCtrl.onChangeInputSearchIcon(),ServicoCtrl.onClickButtonDeleteTag()},onClickButtonEditComissao:function(){$("[data-action='toggleEditComissao']").on("click",function(a){a.preventDefault();var e=$(".toggleComissao"),t=$("input[name='edit_comissao']");e.hasClass("hide")?(e.find("input").attr("data-required",!0).attr("required",!0).removeAttr("disabled"),e.removeClass("hide"),t.val("on")):(e.find("input").removeAttr("data-required").removeAttr("required").attr("disabled",!0),e.addClass("hide"),t.val("off"))})},recebeValoresCalculadora:function(a){var e=a.markup,t=a.encima_net;"new_variation"===a.acao&&($("#new_variation_percent").val(t),$("#new_variation_markup").val(e)),"edit_variation"===a.acao&&($("#edit_variation_percent").val(t),$("#edit_variation_markup").val(e))},onSubmitFormDescricaoServico:function(){$("form[name='descricao']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action?(ServicoCtrl._urlServico=a.data.view,ServicoCtrl._dadosServico=a.data.servico,$("button[data-action='add-categoria']").attr("data-route",a.data.destino),$("input.callback_servico_id").val(a.data.servico.id),swal("Serviço cadastrado","O serviço "+a.data.servico.nome+" foi cadastrado com sucesso!","success").then(function(){ServicoCtrl.nextTab(2)})):swal("Serviço não cadastrado","Não foi possível cadastrar o serviço, tente novamente!","error")}).catch(function(a){App.captureErrorAjax(a)}))})},onSubmitFormCadastroCategoriaServico:function(){$("form[name='new_secao_categoria']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action?swal(a.data.action.title,a.data.action.message,"success").then(function(){$("#add-categoria").modal("hide"),ServicoCtrl.nextTab(3)}):swal(a.data.action.title,a.data.action.message,"error")}).catch(function(a){App.captureErrorAjax(a)}))})},onSubmitFormRegrasVoucher:function(){$("form[name='regras_servico_voucher']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action?swal(a.data.action.title,a.data.action.message,"success").then(function(){ServicoCtrl.nextTab(4)}):swal(a.data.action.title,a.data.action.message,"error")}).catch(function(a){App.captureErrorAjax(a)}))})},onSubmitFormCadastroCampoAdicional:function(){$("form[name='new_field']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action?swal(a.data.action.title,a.data.action.message,"success").then(function(){swal({title:"Cadastrar mais um campo?",text:"Você gostaria de cadastrar mais um campo ou ir para próximo passo?",icon:"info",dangerMode:!0,buttons:["Próximo passo","Novo campo"]}).then(function(a){a?$("form[name='new_field']").trigger("reset"):($("#add-field").modal("hide"),ServicoCtrl.nextTab(6))})}):swal(a.data.action.title,a.data.action.message,"error")}).catch(function(a){App.captureErrorAjax(a)}))})},onSubmitFormFotosServico:function(){$("form[name='fotos_servico']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget),t=new FormData(e[0]);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),t).then(function(a){App.loader.hide(),a.data.action?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),window.location.href=ServicoCtrl._urlServico}):swal(a.data.action.title,a.data.action.message,"error")}).catch(function(a){App.captureErrorAjax(a)}))})},onChangeSelectTipoCorretagem:function(){$("select[name='tipo_corretagem']").on("change",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.val(),o=$(".corretagem-percentual"),n=$(".corretagem-valor-fixo");"CORRETAGEM_FIXA"===t?(o.addClass("hide"),o.find("input").val("").attr("disabled",!0).removeAttr("required"),n.removeClass("hide"),n.find("input").removeAttr("disabled").attr("required",!0)):"CORRETAGEM_PORCENTUAL"===t?(n.addClass("hide"),n.find("input").val("").attr("disabled",!0).removeAttr("required"),o.removeClass("hide"),o.find("input").removeAttr("disabled").attr("required",!0)):(n.removeClass("hide"),n.find("input").val("").attr("disabled",!0).removeAttr("required"),o.addClass("hide"),o.find("input").val("").attr("disabled",!0).removeAttr("required"))})},onChangePhoto:function(){$("input#callback_fotos").on("change",function(a){if(0!==a.currentTarget.files.length){var e=a.currentTarget.files,t=e.length,o=$("input#fotos_servico"),n=o.siblings(".invalid-feedback"),i="";$(".new_imagens").addClass("hide");for(var r=0;r<t;r++){var l=function(a){var t=e[a],r=App.validExtensionFile(t.name,[".jpg",".jpeg",".png"]);if(!App.validMaxSize(t))return swal("A imagem excede os 3MB","A imagem "+t.name+" é maior que 3MB, diminua o peso dela e tente novamente!","error"),{v:!1};if(r){var l=new FileReader;i+=t.name+";",o.val(i),l.onload=function(){var a='<div class="col-xl-3 mb-3 new_imagens"><div class="d-inline-block position-relative w-100"><img src="'+l.result+'" alt="'+t.name+'" class="img-fluid border-3 shadow-sm"></div></div>';$(".list-imagens-servico").append(a)},l.readAsDataURL(t)}else o.addClass("invalid"),n.html("Não foi possível carregar o arquivo, tente novamente!")}(r);if("object"===(void 0===l?"undefined":_typeof(l)))return l.v}}})},onChangeCategoriaCadastroModal:function(){$("select#categoria-cadastro").on("change",function(a){var e=$(a.currentTarget),t=e.attr("data-route"),o=e.val();App.loader.show(),axios.get(t+"/"+o).then(function(a){App.loader.hide();for(var e="",t=a.data.secoes_categoria,o=t.length,n=0;n<o;n++){var i=t[n];e+='<div class="col-xl-6 mt-2 mb-2">\n<div class="styled-checkbox">\n<input type="checkbox" name="secoes[]" id="secao-'+i.id+'" value="'+i.id+'">\n<label for="secao-'+i.id+'">'+i.nome+"</label>\n</div>\n</div>"}$(".list-secoes-categoria").html(e)})})},onClickAdicionarCategoria:function(){$("button[data-action='add-categoria']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("data-route"),o=$(e.attr("data-target"));App.loader.show(),axios.get(t).then(function(a){if(App.loader.hide(),a.data.categorias.length>0){for(var e="<option value='' selected disabled>Selecione um categoria</option>",t=a.data.categorias,n=a.data.categorias.length,i=0;i<n;i++)e+="<option value='"+t[i].id+"'>"+t[i].nome+"</option>";$("select#categoria-cadastro").html(e),$("label[for='categoria-cadastro']").html("Categorias disponíveis em "+a.data.nome),$(".list-secoes-categoria").html("<div class='col-xl-12'><div class='alert alert-primary-bordered alert-lg square'><p class='m-0'>Selecione uma categoria.</p></div></div>"),o.modal("show")}else swal("Sem categorias para o destino!","O destino não possui categorias cadastradas, tente novamente.","error")}).catch(function(){App.loader.hide(),swal("Destino não encontrado!","Não foi possível encontrar o destino, tente novamente.","error")})})},onClickButtonProximoPasso:function(){$("button[data-action='nextStep']").on("click",function(a){a.preventDefault(),ServicoCtrl.nextTab(6)})},onClickButtonEditField:function(){$("[data-action='edit-field']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){App.loader.hide(),a=a.data;var e=$("#edit-field");e.find("form").trigger("reset"),e.find("#edit_field_nome").val(a.campo),e.find("#edit_field_placeholder").val(a.placeholder),e.find("input[name='campo_id']").val(a.id),e.find("[data-field='"+a.obrigatorio+"']").attr("checked",!0),e.modal("show")})})},onClickButtonDeleteCampo:function(){$("button[data-action='delete']").on("click",function(a){a.preventDefault();var e=$("input[name='delete_campo']");e.val("on"),e.parents("form").trigger("submit")})},onClickButtonActivateField:function(){$("[data-action='activate-field']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href"),o=e.attr("data-id");App.loader.show(),axios.post(t,{campo_id:o}).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")})})},onClickButtonEditPhoto:function(){$("[data-action='edit-photo']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){App.loader.hide(),a=a.data;var e=$("#edit-photo");e.find("form").trigger("reset"),e.find("input[type='checkbox']").attr("checked",!1),e.find("#foto_modal").attr("src",a.FotoLarge),e.find("#legenda_foto").val(a.legenda),e.find("input[name='foto_id']").val(a.id),e.find("[data-principal='"+a.tipo+"']").attr("checked",!0),e.modal("show")})})},onClickButtonDeleteFoto:function(){$("button[data-action='delete_photo']").on("click",function(a){a.preventDefault();var e=$("input[name='delete_foto']");e.val("on"),e.parents("form").trigger("submit")})},onClickButtonEditCategoria:function(){$("[data-action='edit-categoria']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href"),o=$("#edit-categoria");App.loader.show(),axios.get(t).then(function(a){a=a.data
;var e=a.categorias[0],t=o.find("select#tipo_categoria");t.find("option").attr("selected",!1),t.find('option[value="'+e.pivot.padrao+'"]').attr("selected",!0),t.selectpicker("refresh"),o.find("form").trigger("reset"),o.find("#categoria_edit").val(e.nome+" - "+e.destino.nome),o.find("input[name='categoria_id']").val(e.id);for(var n="",i=e.secoes_categoria,r=i.length,l=a.secoes_categoria,c=l.length,d=0;d<r;d++){for(var s=i[d],u="",v=0;v<c;v++)if(l[v].id===s.id){u="checked";break}n+='<div class="col-xl-6 mt-2 mb-2">\n<div class="styled-checkbox">\n<input type="checkbox" name="secoes[]" id="secao-edit-'+s.id+'" '+u+' value="'+s.id+'">\n<label for="secao-edit-'+s.id+'">'+s.nome+"</label>\n</div>\n</div>"}$(".list-edit-secoes-categoria").html(n),App.loader.hide(),o.modal("show")})})},onClickButtonDeleteCategoria:function(){$("button[data-action='delete_category']").on("click",function(a){a.preventDefault();var e=$("input[name='delete_category']");e.val("on"),e.parents("form").trigger("submit")})},onClickButtonEditMarkup:function(){$("[data-action='edit-markup']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){App.loader.hide(),a=a.data;var e=$("#edit-markup");e.find("form").trigger("reset"),e.find("#markup_atual").val(a.markup),e.find("#new_markup").val(a.markup),e.find("input[name='variacao_id']").val(a.id),e.modal("show")})})},onClickButtonEditVariation:function(){$("[data-action='edit-variation']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){App.loader.hide(),a=a.data;var e=$("#edit-variation"),t=$("select#edit_tipo_variacao");e.find("form").trigger("reset"),e.find("input[type='radio']").attr("checked",!1),t.find("option").removeAttr("selected"),e.find("#edit_variation_name").val(a.nome),e.find("#edit_variation_description").val(a.descricao),e.find("#edit_variation_percent").val(a.percentual),e.find("#edit_variation_markup").val(a.markup),e.find("[data-bloqueio='"+a.consome_bloqueio+"']").attr("checked",!0),e.find("input[name='variacao_id']").val(a.id),t.find("option[data-tipo-variacao='"+a.destaque+"']").attr("selected",!0),t.selectpicker("refresh"),e.modal("show")})})},onClickButtonDeleteVariacao:function(){$("button[data-action='delete_variacao']").on("click",function(a){a.preventDefault();var e=$("input[name='delete_variacao']");e.val("on"),e.parents("form").trigger("submit")})},onClickButtonActivateVariation:function(){$("[data-action='activate-variation']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href"),o=e.attr("data-id");App.loader.show(),axios.post(t,{variacao_id:o}).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")})})},onSubmitFormCadastroVariacaoServico:function(){$("form[name='new_variation_service']").on("submit",function(a){a.preventDefault();var e=$(a.currentTarget);App.validateForm(e)&&(App.loader.show(),axios.post(e.attr("action"),e.serialize()).then(function(a){App.loader.hide(),a.data.action?swal(a.data.action.title,a.data.action.message,"success").then(function(){swal({title:"Cadastrar mais uma variação?",text:"Você gostaria de cadastrar mais uma variação ou ir para próximo passo?",icon:"info",dangerMode:!0,buttons:["Próximo passo","Nova variação"]}).then(function(a){if(a){var e=$("form[name='new_variation_service']"),t=$("select#new_tipo_variacao");e.trigger("reset"),e.find("input[type='radio']").attr("checked",!1),t.find("option").removeAttr("selected"),t.selectpicker("refresh")}else $("#add-variation").modal("hide"),ServicoCtrl.nextTab(5)})}):swal(a.data.action.title,a.data.action.message,"error")}).catch(function(a){App.captureErrorAjax(a)}))})},nextTab:function(a){for(var e=$("ul#tab_servico li a"),t=e.length,o=0;o<t;o++){var n=$(e[o]);n.removeClass("active").addClass("disabled"),o+1===a&&n.removeClass("disabled").click()}},onChangeInputSearchIcon:function(){$("[data-action='search']").on("keyup",function(a){for(var e=$(a.currentTarget),t=$(e.attr("data-target")),o=t.find("button"),n=o.length,i=Plugins.removerAcentos(e.val().trim().toLowerCase()),r=0;r<n;r++){var l=$(o[r]);Plugins.removerAcentos(l.find("p").text().toLowerCase()).indexOf(i)>-1?l.parent().removeClass("d-none"):l.parent().addClass("d-none")}})},loadIconesTag:function(a,e,t,o){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;window.App.loader.show(),"INTERNA"==t&&(a=$("#link-icones2").text()),axios.get(a).then(function(a){var i=a.data,r=i.length,l="";if(ServicoCtrl.isTagExterna(t))for(var c=0;c<r;c++){var d=i[c],s=n===d.name?"active":"";l+='<div class="col-2"><button class="'+s+'" data-action="clickIcon" data-icon="'+d.name+'"><i class="jam jam-'+d.name+'"></i><p class="mb-0 text-truncate">'+d.name+"</p></button></div>"}else for(var u in i){var v=i[u];for(var p in v.icons){var m=v.icons[p];l+='<div class="col-2"><button class="" data-action="clickIcon" data-icon="'+v.prefix+" fa-"+m+'"><i class="'+v.prefix+" fa-"+m+' icone"></i><p class="mb-0 text-truncate">'+m+"</p></button></div>"}}e.find(".list-icones-tag").html(l),$("[data-action='clickIcon']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget);o(e.attr("data-icon"),e)}),window.App.loader.hide(),e.modal("show"),n&&setTimeout(function(){var a=e.find(".list-icones-tag"),t=a.find("button.active").parent();ServicoCtrl.scrollIfNeeded(t[0],a[0])},500)})},scrollIfNeeded:function(a,e){if(a.offsetTop<e.scrollTop)e.scrollTop=a.offsetTop;else{var t=a.offsetTop+a.offsetHeight;t>e.scrollTop+e.offsetHeight&&(e.scrollTop=t-e.offsetHeight)}},onClickButtonOpenModalTag:function(){$("[data-action='newTag']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=$(e.attr("data-target")),o=e[0].getAttribute("tipo-tag");ServicoCtrl.isTagExterna(o)?(ServicoCtrl.hideCampoTituloModal(),ServicoCtrl.setFormTagToExterna()):(ServicoCtrl.showCampoTituloModal(),ServicoCtrl.setFormTagToInterna());var n=function(){t.find(".list-icones-tag").html(""),t.off("hide.bs.modal")};t.on("hide.bs.modal",n),ServicoCtrl.loadIconesTag(e.attr("data-route"),t,o,function(a,e){t.find(".list-icones-tag button.active").not(e).removeClass("active"),e.addClass("active"),t.find("[name='icone']").val(a)})})},onClickButtonEditTag:function(){$("[data-action='editTag']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=$(e.attr("data-target")),o=e[0].getAttribute("tipo-tag"),n=function(){t.find(".list-icones-tag").html(""),t.off("hide.bs.modal")};ServicoCtrl.isTagExterna(o)?(ServicoCtrl.hideCampoTituloModal(),ServicoCtrl.setFormTagToExterna()):(ServicoCtrl.showCampoTituloModal(),ServicoCtrl.setFormTagToInterna()),t.on("hide.bs.modal",n),window.App.loader.show(),axios.get(e.attr("data-tag")).then(function(a){t.find("[name='titulo']").val(a.data.titulo),t.find("[name='descricao']").val(a.data.descricao),t.find("[name='ordem']").val(a.data.ordem),t.find("[name='icone']").val(a.data.icone),t.find("[name='tag_id']").val(a.data.id),ServicoCtrl.loadIconesTag(e.attr("data-route"),t,o,function(a,e){t.find(".list-icones-tag button.active").not(e).removeClass("active"),e.addClass("active"),t.find("[name='icone']").val(a)},a.data.icone)}).catch(window.App.captureErrorAjax)})},onClickButtonDeleteTag:function(){$("button[data-action='delete-tag']").on("click",function(a){a.preventDefault();var e=$("input[name='delete_tag']");e.val("on"),e.parents("form").trigger("submit")})},showCampoTituloModal:function(){$("#campo-titulo").css("display","block"),$("#titulo_tag_new").attr("disabled",!1),$("#campo-titulo2").css("display","block"),$("#titulo_tag_new2").attr("disabled",!1)},hideCampoTituloModal:function(){$("#campo-titulo").css("display","none"),$("#titulo_tag_new").attr("disabled","true"),$("#campo-titulo2").css("display","none"),$("#titulo_tag_new2").attr("disabled","true")},setFormTagToInterna:function(){var a=$("#link-cadastrar2").text(),e=$("#link-atualizar2").text();$("#form-tag").attr("action",a),$("#form-tag2").attr("action",e)},setFormTagToExterna:function(){var a=$("#link-cadastrar").text(),e=$("#link-atualizar").text();$("#form-tag").attr("action",a),$("#form-tag2").attr("action",e)},isTagExterna:function(a){return"EXTERNA"==a}},SidebarCtrl={init:function(){SidebarCtrl.activeMenu(),SidebarCtrl.correctScroll()},correctScroll:function(){$(".side-navbar a[data-toggle='collapse']").on("click",function(){setTimeout(function(){$(".sidebar-scroll").getNiceScroll().resize()},200)}),$(".side-navbar.sidebar-scroll").on("mouseenter",function(){$(".sidebar-scroll").getNiceScroll().resize()})},activeMenu:function(){for(var a=window.location.href,e=$(".side-navbar a.item-menu"),t=e.length,o=0;o<t;o++){var n=$(e[o]),i=n.attr("href").trim();if(-1!==a.indexOf(i)){var r=n.parents("ul").attr("id");if(void 0===r){n.parent().addClass("active");break}var l=$("a[href='#"+r+"']");if(l.parent().addClass("active"),a===i){n.parent().addClass("active"),l.click();break}}}}},TerminaisCtrl={init:function(){TerminaisCtrl.onClickButtonEditUser(),TerminaisCtrl.onClickButtonDesativarUsuario(),TerminaisCtrl.onClickButtonAtivarUsuario(),TerminaisCtrl.onClickButtonViewHistory(),TerminaisCtrl.onClickVerReservasPrevisao()},onClickVerReservasPrevisao:function(){$("[data-action='view-previsao']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){a=a.data,App.loader.hide();var e=$("#view-comissao");TerminaisCtrl.createTableVendasComissao(a,e),e.modal("show")})})},createTableVendasComissao:function(a,e){var t="",o=0,n=0,i=0,r=0,l=0,c=a.vendas.length;e.find(".modal-title").html("Detalhes comissão "+a.mes);for(var d=0;d<c;d++){var s=a.vendas[d];o++,n+=parseFloat(s.reserva_pedido.valor_total),s.status===a.pago?l+=parseFloat(s.comissao):s.status===a.cancelado?r+=parseFloat(s.comissao):s.status===a.aguardando&&(i+=parseFloat(s.comissao));var u=s.created_at.split(" ")[0].split("-"),v=a.cores[s.status];t+='<tr>\n                    <td class="text-primary">'+(d+1)+'</td>\n                    <td>\n                        <a href="'+a.url_reserva+"/"+s.reserva_pedido.voucher+'" target="_blank" class="text-secondary">#'+s.reserva_pedido.voucher+'</a>\n                    </td>\n                    <td class="text-primary">('+s.reserva_pedido.quantidade+"x) "+s.reserva_pedido.servico.nome.slice(0,35)+'...</td>\n                    <td class="text-primary text-center">R$ '+window.App.formataValor(s.reserva_pedido.valor_total,2)+'</td>\n                    <td class="text-center"><strong class="text-'+v+'">R$ '+window.App.formataValor(s.comissao,2)+'</strong></td>\n                    <td class="text-center"><strong class="text-'+v+' text-capitalize">'+s.status.toLowerCase()+'</strong></td>\n                    <td class="text-center text-primary">'+u[2]+"/"+u[1]+"/"+u[0]+"</td>\n                </tr>"}e.find("table tbody").html(t),e.find("[data-text='vendido']").html("R$ "+window.App.formataValor(n,2)),e.find("[data-text='comissao']").html("R$ "+window.App.formataValor(l,2)),e.find("[data-text='comissao_pendente']").html("R$ "+window.App.formataValor(i,2)),e.find("[data-text='comissao_cancelada']").html("R$ "+window.App.formataValor(r,2)),e.find("[data-text='reservas']").html(o+" reserva(s)")},onClickButtonAtivarUsuario:function(){$("[data-action='activate-user']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href"),o=e.attr("data-id");App.loader.show(),axios.put(t,{usuario_id:o}).then(function(a){App.loader.hide(),a.data.action.result?swal(a.data.action.title,a.data.action.message,"success").then(function(){App.loader.show(),location.reload()}):swal(a.data.action.title,a.data.action.message,"error")})})},onClickButtonEditUser:function(){$("[data-action='edit-user']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){App.loader.hide(),a=a.data;var e=$("#edit-user");e.find("form").trigger("reset"),e.find("input[type='checkbox']").attr("checked",!1),e.find("#edit_nome_usuario").val(a.nome),e.find("#edit_email_usuario").val(a.email),e.find("input[name='usuario_id']").val(a.id),e.modal("show")})})},onClickButtonDesativarUsuario:function(){$("button[data-action='desativar']").on("click",function(a){a.preventDefault();var e=$("input[name='desativar_usuario']");e.val("on"),e.parents("form").trigger("submit")})},initMap:function(){var a=$("#google-map"),e=parseFloat(a.attr("data-lat"))||-29.3774968,t=parseFloat(a.attr("data-lng"))||-50.8710002,o=new google.maps.Map(a[0],{center:{lat:e,lng:t},zoom:16,scrollwheel:!1,draggable:!1,mapTypeControl:!1,disableDefaultUI:!1,gestureHandling:"none",zoomControl:!0,scaleControl:!1,streetViewControl:!1}),n=$("#search_google"),i=new google.maps.places.Autocomplete(n[0]);i.bindTo("bounds",o),i.setFields(["address_components","geometry","icon","name"]);var r=new google.maps.InfoWindow,l=document.getElementById("infowindow-content");r.setContent(l);var c=new google.maps.Marker({map:o,anchorPoint:new google.maps.Point(0,-29)});n.on("focus",function(){n.attr("autocomplete","nope")}),i.addListener("place_changed",function(){r.close(),c.setVisible(!1);var a=i.getPlace();if(!a.geometry)return void window.alert("No details available for input: '"+a.name+"'");a.geometry.viewport?o.fitBounds(a.geometry.viewport):(o.setCenter(a.geometry.location),o.setZoom(17)),c.setPosition(a.geometry.location),c.setVisible(!0);var e="",t={localname:a.name};if(a.address_components){for(var n=a.address_components.length,d=0;d<n;d++){var s=a.address_components[d];"street_number"===s.types[0]&&(t.number=s.long_name||"00"),"route"===s.types[0]&&(t.address=s.long_name),"sublocality_level_1"===s.types[0]&&(t.neighboard=s.short_name),"administrative_area_level_2"===s.types[0]&&(t.city=s.long_name),"administrative_area_level_1"===s.types[0]&&(t.estate=s.short_name),"postal_code"===s.types[0]&&(t.zip=s.short_name),"country"===s.types[0]&&(t.country=s.long_name)}e=t.address+", "+(t.number||"00")+" -<br>"+t.neighboard+"<br>"+t.city+" - ",e+=t.estate+"<br>"+t.zip+"<br>"+t.country}l.children["place-name"].innerHTML=a.name,l.children["place-address"].innerHTML=e,r.open(o,c);var u=a.geometry.location.lat().toString().substring(0,11),v=a.geometry.location.lng().toString().substring(0,11);$("input[name='nome_local']").val(t.localname),$("input[name='endereco']").val(t.address+", "+(t.number||"00")+" - "+t.neighboard),$("input[name='cidade']").val(t.city),$("input[name='cep']").val(t.zip),$("input[name='geolocation']").val(u+","+v);var p=$("select#estado");p.find("option[data-uf='"+t.estate+"']").attr("selected",!0),p.selectpicker("refresh")}),setTimeout(function(){if(void 0!==window.maps){var a=window.maps.endereco+"<br>"+window.maps.cidade+" - ";a+=window.maps.estado+"<br>"+window.maps.cep+"<br>Brasil";var n=new google.maps.LatLng(e,t);l.children["place-name"].innerHTML=window.maps.nome_local,l.children["place-address"].innerHTML=a,c.setPosition(n),c.setVisible(!0),r.open(o,c)}},500)},onClickButtonViewHistory:function(){$("[data-action='view-history']").on("click",function(a){a.preventDefault();var e=$(a.currentTarget),t=e.attr("href");App.loader.show(),axios.get(t).then(function(a){a=a.data,App.loader.hide();var e=$("#view-history"),t=a.payload;for(var o in t)t.hasOwnProperty(o)&&$("[data-text='"+o+"']").html(t[o]);var n=a.created_at.split("-"),i=n[2].split(" ");$("[data-text='date']").html(i[0]+"/"+n[1]+"/"+n[0]+" "+i[1]);var r=t.location,l=e.find("#mapa-termina-conexao"),c=new google.maps.Map(l[0],{center:{lat:parseFloat(r.latitude),lng:parseFloat(r.longitude)},zoom:15,scrollwheel:!1,draggable:!1,mapTypeControl:!1,disableDefaultUI:!1,gestureHandling:"none",zoomControl:!0,scaleControl:!1,streetViewControl:!1});new google.maps.Marker({map:c,anchorPoint:new google.maps.Point(0,-29)}).setPosition({lat:parseFloat(r.latitude),lng:parseFloat(r.longitude)}),e.modal("show")})})}},VendaInternaCtrl={servico:[],servico_informacao:[],data_selecionada:[],variacoes:[],init:function(a){Plugins.loadLibDateRanger(),VendaInternaCtrl.onSelectServico(),VendaInternaCtrl.onSelectStatusPagamento(),VendaInternaCtrl.onClickBotaoCadastrarCliente(),VendaInternaCtrl.adicionarReserva(),VendaInternaCtrl.consultarEmailTitularNoBanco(),VendaInternaCtrl.loadAcompanhantesSeTitularPreenchido(),VendaInternaCtrl.setCupomDesconto(),VendaInternaCtrl.unsetCupomDesconto()},onAddPessoa:function(){$(".i-adicionar").on("click",function(a){var e=a.target.getAttribute("valor");if(void 0==VendaInternaCtrl.data_selecionada.disponibilidade_usada&&(VendaInternaCtrl.data_selecionada.disponibilidade_usada=0),VendaInternaCtrl.data_selecionada.disponibilidade-VendaInternaCtrl.data_selecionada.disponibilidade_usada<=0)return void alert("Sem disponibilidade");void 0==VendaInternaCtrl.variacoes[e].quantidade?VendaInternaCtrl.variacoes[e].quantidade=1:VendaInternaCtrl.variacoes[e].quantidade++,"SIM"==VendaInternaCtrl.variacoes[e].bloqueio&&VendaInternaCtrl.data_selecionada.disponibilidade_usada++,$("#contador-"+e).text(VendaInternaCtrl.variacoes[e].quantidade),VendaInternaCtrl.setValorTotal()})},onRemovePessoa:function(){$(".i-remover").on("click",function(a){var e=a.target.getAttribute("valor");if(void 0==VendaInternaCtrl.data_selecionada.disponibilidade_usada&&(VendaInternaCtrl.data_selecionada.disponibilidade_usada=0),0!=VendaInternaCtrl.variacoes[e].quantidade){void 0==VendaInternaCtrl.variacoes[e].quantidade?VendaInternaCtrl.variacoes[e].quantidade=0:VendaInternaCtrl.variacoes[e].quantidade--,"SIM"==VendaInternaCtrl.variacoes[e].bloqueio&&VendaInternaCtrl.data_selecionada.disponibilidade_usada--;$("#contador-"+e).text(VendaInternaCtrl.variacoes[e].quantidade),VendaInternaCtrl.setValorTotal()}})},onSelectServico:function(){$("#select-servico").on("change",function(a){App.loader.show(),VendaInternaCtrl.clearTelaVariacoes(),VendaInternaCtrl.clearTelaValorTotal(),VendaInternaCtrl.clearTelasInformacoes();var e=($("#new_date").val(""),a.target.value),t=a.target.getAttribute("data-url")+"?servico_id="+e;axios.get(t).then(function(a){VendaInternaCtrl.servico=a.data.servico,t=$("#new_date").attr("data-url")+"?uuid="+VendaInternaCtrl.servico.uuid,axios.get(t).then(function(a){VendaInternaCtrl.dates_calendario=a.data.events,VendaInternaCtrl.dates_disponibilidade=a.data.disponibilidade,VendaInternaCtrl.servico_informacao=a.data,VendaInternaCtrl.setDatePicker(a),App.loader.hide()})})})},setDatePicker:function(a){var e=$("#new_date");e.daterangepicker({minDate:VendaInternaCtrl.dataToIE(a.data.events[0].date),singleDatePicker:!0,autoUpdateInput:!1,isCustomDate:VendaInternaCtrl.filterDateCalendar,locale:{format:"DD/MM/YYYY",daysOfWeek:["Do","2º","3º","4º","5º","6º","Sá"],monthNames:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]}}),e.on("apply.daterangepicker",VendaInternaCtrl.onSelectDateCalendar)},onSelectDateCalendar:function(a,e){var t="";$(a.currentTarget).val(e.startDate.format("DD/MM/YYYY"));for(var o=e.startDate.format("YYYY-MM-DD"),n=VendaInternaCtrl.dates_disponibilidade.length,i=0;i<n;i++){var r=VendaInternaCtrl.dates_disponibilidade[i];r.data===o&&(t=r.data_servico_id,VendaInternaCtrl.data_selecionada=r,VendaInternaCtrl.variacoes=r.variacoes)}VendaInternaCtrl.setTelaVariacoes(),VendaInternaCtrl.onAddPessoa(),VendaInternaCtrl.onRemovePessoa(),$("input[name='data_agenda_id']").val(t)},setTelaVariacoes:function(){VendaInternaCtrl.clearTelaVariacoes(),VendaInternaCtrl.setTelaValorTotal();for(var a=($("#variacoes-reserva-titulo").css("display","block"),VendaInternaCtrl.data_selecionada.variacoes),e=$("#variacoes-reserva"),t=0;t<a.length;t++){var o=a[t];e.append('\n                <div class="row">\n                    <div class="col-xl-8">\n                        <label class="form-control-label" style="margin-bottom:0px;">'+o.variacao+" <small>"+o.descricao+'</small></label>\n                        <br>\n                        <label style="color: #097a27; font-weight: bold; font-size: large;">R$'+o.valor_venda_brl+'</label>\n                    </div>\n                    <div class="col" style="text-align:center;">\n                        <span style="font-size: 25px; color: #2c304d;">\n                            <i class="la la-minus add-remove-icon noselect i-remover" valor="'+t+'"></i>\n                            <span class="noselect" id="contador-'+t+'">0</span>\n                            <i class="la la-plus add-remove-icon noselect i-adicionar" valor="'+t+'"></i>\n                        </span>\n                    </div>\n                </div>\n                ')}},setTelaValorTotal:function(){$("#inside-column-valor-total").css("display","block"),$("#valor_total").text("R$ 0,00")},clearTelaValorTotal:function(){$("#inside-column-valor-total").css("display","none")},setValorTotal:function(){for(var a=0,e=0;e<VendaInternaCtrl.variacoes.length;e++)void 0!=VendaInternaCtrl.variacoes[e].quantidade&&(a+=VendaInternaCtrl.variacoes[e].valor_venda*VendaInternaCtrl.variacoes[e].quantidade);$("#valor_total").text(""+a.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}))},clearTelaVariacoes:function(){$("#variacoes-reserva").empty();$("#variacoes-reserva-titulo").css("display","none")},filterDateCalendar:function(a){for(var e=VendaInternaCtrl.dates_calendario.length,t=a.format("YYYY-MM-DD")+" 00:00:00",o=0;o<e;o++){if(VendaInternaCtrl.dates_calendario[o].date===t)return""}return"disabled"},onSelectStatusPagamento:function(){$("#select-pagamento").on("change",function(a){var e=$("#select-pagamento"),t=$("#botao-adicionar-servico"),o=$("#botao-cadastrar-cliente");"PAGO"==e.val()?(t.css("display","none"),o.css("display","block")):"PENDENTE"==e.val()&&(o.css("display","none"),t.css("display","block"),VendaInternaCtrl.clearTelaCadastrarClientes())})},clearTelaCadastrarClientes:function(){$("#botao-cadastrar-cliente-post").css("display","none"),$("#cad-cli").css("display","none"),$("#container-clientes").empty()},clearTelaCadastrarTitular:function(){$("#cad-titular").css("display","none")},clearTelaCadastrarCamposAdicionais:function(){$("#container-row-campos-adicionais").css("display","none"),$("#container-campos-adicionais").empty()},clearTelasInformacoes:function(){VendaInternaCtrl.clearTelaCadastrarClientes(),VendaInternaCtrl.clearTelaCadastrarTitular(),VendaInternaCtrl.clearTelaCadastrarCamposAdicionais()},getQuantidadeClientesSelecionados:function(){for(var a=0,e=VendaInternaCtrl.variacoes,t=0;t<e.length;t++){var o=e[t];void 0!=o.quantidade&&(a+=o.quantidade)}return a},onClickBotaoCadastrarCliente:function(){$("#botao-cadastrar-cliente").on("click",function(a){if(VendaInternaCtrl.getQuantidadeClientesSelecionados()<=0)return alert("Selecione a quantidade de clientes");if(VendaInternaCtrl.clearTelaCadastrarClientes(),$("#cad-pagamento").css("display","block"),$("#cad-titular").css("display","block"),"SOLICITA_INFO_CLIENTES"==VendaInternaCtrl.servico.info_clientes){var e=VendaInternaCtrl.variacoes,t=$("#container-clientes");$("#cad-cli").css("display","block"),0==VendaInternaCtrl.servico_informacao.campos_adicionais.length&&$("#botao-cadastrar-cliente-post").css("display","block");for(var o=0,n=0;n<e.length;n++){var i=e[n];if(void 0!=i.quantidade)for(var r=0;r<i.quantidade;r++)t.append('\n                                <div class="row">\n                                    <strong class="info-terminal">'+(o+1)+"° Acompanhante - "+i.variacao+'</strong>\n                                </div>\n                                <div class="row list-acompanhantes">\n                                    <div class="col-xl-4 mb-3">\n                                        <label for="nome_acop_'+o+'" class="form-control-label">Nome completo</label>\n                                        <div class="input-group">\n                                            <span class="input-group-addon addon-secondary">\n                                                <i class="la la-user"></i>\n                                            </span>\n                                            <input id="nome_acop_'+o+'" type="text" class="form-control disable-action" placeholder="Nome completo do acompanhante" required}}\n                                                data-required data-min="5" title="Nome do acompanhante" data-auto-capitalize name="nome" autocomplete="off" data-list="nomes_acom" data-callback="nome">\n                                            <div class="invalid-feedback"></div>\n                                        </div>\n                                    </div>\n\n                                    <div class="col mb-3">\n                                        <label for="documento_acop_'+o+'" class="form-control-label">Núm. documento </label>\n                                        <div class="input-group">\n                                            <span class="input-group-addon addon-secondary">\n                                                <i class="la la-file-text"></i>\n                                            </span>\n                                            <input id="documento_acop_'+o+'" type="text" class="form-control disable-action" placeholder="CPF ou RG do acompanhante" required\n                                                    data-required data-min="1" title="Documento do acompanhante" name="documento"  autocomplete="off" data-list="doc_acom" data-callback="documento">\n                                            <div class="invalid-feedback"></div>\n                                        </div>\n                                    </div>\n\n                                    <div class="col mb-3">\n                                        <label for="nascimento_acop_'+o+'" class="form-control-label">Nascimento</label>\n                                        <div class="input-group">\n                                            <span class="input-group-addon addon-secondary">\n                                                <i class="la la-calendar"></i>\n                                            </span>\n                                            <input id="nascimento_acop_'+o+'" type="tel" class="form-control vanillaMask disable-action" placeholder="DD/MM/AAAA" required data-mask="date"\n                                                    data-required data-min="5" title="Nascimento do acompanhante" name="nascimento"  autocomplete="off"  data-list="data_acom" data-callback="nascimento">\n                                            <div class="invalid-feedback"></div>\n                                        </div>\n                                    </div>\n                                </div>\n                            '),o++;window.location.href="#botao-cadastrar-cliente"}App.vanillaMask()}else 0==VendaInternaCtrl.servico_informacao.campos_adicionais.length&&$("#container-botao-cadastrar-titular-post").css("display","block");VendaInternaCtrl.setTelaCamposAdicionais()})},setTelaCamposAdicionais:function(){var a=VendaInternaCtrl.servico_informacao.campos_adicionais,e=$("#container-campos-adicionais"),t=0;if(0!=a.length){$("#container-row-campos-adicionais").css("display","block");for(var o=0;o<a.length;o++){e.append('\n                <div class="form-group row mb-3" id="campos-coluna-0">\n                </div>\n            ');for(var n=$("#campos-coluna-0"),i=0;i<2;i++){var r=a[t];n.append('\n                    <div class="col-auto mb-3">\n                        <label for="adicional_'+t+'" class="form-control-label">'+r.campo+'</label>\n                        <input id="campo_'+t+'_texto" titulo="'+r.campo+'" type="text" class="form-control disable-action" placeholder="'+r.placeholder+'" data-min="2">\n                        <input id="campo_'+t+'_campo_adicional_id" type="hidden" name="adicionais[][campo_adicional_id]" value="'+r.id+'">\n                        <div class="invalid-feedback"></div>\n                    </div>\n                '),t++}n++}}},adicionarReserva:function(){$("#botao-adicionar-servico").on("click",function(a){var e=VendaInternaCtrl,t={servico:e.servico,agenda:e.data_selecionada,variacoes:e.variacoes,tipo_pagamento:$("#select-pagamento").val()},o=$("#link-carrinho-adicionar").attr("link");axios.post(o,t).then(function(a){window.location.reload()})}),$("#botao-cadastrar-cliente-post").on("click",function(a){VendaInternaCtrl.postAddReserva()}),$("#botao-cadastrar-campo-adicional-post").on("click",function(a){VendaInternaCtrl.postAddReserva()}),$("#botao-cadastrar-titular-post").on("click",function(a){VendaInternaCtrl.postAddReserva()})},postAddReserva:function(){if(0!=VendaInternaCtrl.validarPagamento()&&0!=VendaInternaCtrl.validarTitularPedido()&&0!=VendaInternaCtrl.validarClientesReserva()&&0!=VendaInternaCtrl.validarCamposAdicionais()){App.loader.show();var a=VendaInternaCtrl,e={servico:a.servico,agenda:a.data_selecionada,variacoes:a.variacoes,tipo_pagamento:$("#select-pagamento").val()},t=$("#link-carrinho-adicionar").attr("link"),o=0,n=[];if("SOLICITA_INFO_CLIENTES"==VendaInternaCtrl.servico.info_clientes)for(var i=0;i<a.variacoes.length;i++){var r=a.variacoes[i];if(void 0!=r.quantidade)for(var l=0;l<r.quantidade;l++){var c=$("#nome_acop_"+o).val(),d=$("#documento_acop_"+o).val(),s=$("#nascimento_acop_"+o).val();n.push({nome:c,documento:d,nascimento:s,variacao_servico_id:r.variacao_id}),o++}}var u=$("#titular-email").val();DadosFactory.saveDadosAcompanhantes(n,u);for(var v=[],p=0;p<VendaInternaCtrl.servico_informacao.campos_adicionais.length;p++){var m={campo_adicional_servico_id:$("#campo_"+p+"_campo_adicional_id").val(),informacao:$("#campo_"+p+"_texto").val()};v.push(m)}var f={nome:$("#titular-nome").val(),email:$("#titular-email").val(),telefone:$("#titular-telefone").val(),documento:$("#titular-documento").val(),nascimento:$("#titular-nascimento").val(),endereco:$("#titular-endereco").val()},g={meio_pagamento:$("#select-meio-pagamento").val(),metodo_pagamento:$("#select-metodo-pagamento").val()};e.titular_pedido=f,e.acompanhantes=n,e.campos_adicionais=v,e.pagamento=g,axios.post(t,e).then(function(a){window.location.reload()})}},validarTitularPedido:function(){var a={nome:$("#titular-nome").val(),email:$("#titular-email").val(),telefone:$("#titular-telefone").val(),documento:$("#titular-documento").val(),nascimento:$("#titular-nascimento").val(),endereco:$("#titular-endereco").val()};return a.nome.length<5?(swal("Nome do titular inválido","O nome do titular deve conter pelo menos 5 caracteres.","warning"),!1):0==App.isMail(a.email)?(swal("E-mail do titular inválido","O e-mail do titular deve ser válido.","warning"),!1):16!=a.telefone.length?(swal("Telefone do titular inválido","O telefone do titular deve ser válido.","warning"),!1):14!=a.documento.length?(swal("Documento do titular inválido","O documento do titular deve ser válido.","warning"),!1):10==a.nascimento.length&&App.isValidDate(a.nascimento)?void 0:(swal("Data de nascimento do titular inválida","A data de nascimento do titular deve ser válida.","warning"),!1)},validarClientesReserva:function(){var a=VendaInternaCtrl;if("SOLICITA_INFO_CLIENTES"==a.servico.info_clientes){for(var e=0,t=0;t<a.variacoes.length;t++){var o=a.variacoes[t];if(void 0!=o.quantidade)for(var n=0;n<o.quantidade;n++){var i=$("#nome_acop_"+e).val(),r=$("#documento_acop_"+e).val(),l=$("#nascimento_acop_"+e).val();if(i.length<5)return swal("Nome do cliente inválido","O nome do cliente "+(e+1)+" deve conter pelo menos 5 caracteres.","warning"),!1;if(r.length<5)return swal("Documento do cliente inválido","O documento do cliente "+(e+1)+" deve conter pelo menos 5 caracteres.","warning"),!1
;if(10!=l.length||0==App.isValidDate(l))return swal("Data de nascimento do cliente inválida","A data de nascimento do cliente "+(e+1)+" deve ser válida.","warning"),!1;e++}}return!0}},validarCamposAdicionais:function(){for(var a=0;a<VendaInternaCtrl.servico_informacao.campos_adicionais.length;a++){var e=$("#campo_"+a+"_texto"),t=e.val(),o=e.attr("titulo");if(t.length<4)return swal("Campo adicional inválido","O(A) "+o+" deve conter pelo menos 4 caracteres.","warning"),!1}return!0},validarPagamento:function(){var a=$("#select-meio-pagamento").val(),e=$("#select-metodo-pagamento").val();return""==a?(swal("Meio de pagamento inválido","Selecione o meio de pagamento do pedido","warning"),!1):""==e?(swal("Método de pagamento inválido","Selecione o método de pagamento do pedido","warning"),!1):void 0},consultarEmailTitularNoBanco:function(){$("#titular-email").on("blur",function(a){App.loader.show();var e=$("#link-consultar-email").attr("link"),t=$("#titular-email").val(),o={email:t};axios.post(e,o).then(function(a){var e=a.data.cliente;if(null!=e){var o=$("#titular-nome"),n=$("#titular-telefone"),i=$("#titular-documento"),r=$("#titular-nascimento");$("#titular-endereco");VendaInternaCtrl.setEdicaoCamposTitular(!0),o.val(e.nome),n.val(e.telefone),i.val(e.cpf);var l=new Date(e.nascimento),c=VendaInternaCtrl.formatarDateJSParaTexto(l);r.val(c),DadosFactory.loadAcompanhantes(t)}else{$("#titular-nascimento");VendaInternaCtrl.setEdicaoCamposTitular(!1)}App.loader.hide()})})},setEdicaoCamposTitular:function(a){var e=$("#titular-nome"),t=$("#titular-telefone"),o=$("#titular-documento"),n=$("#titular-nascimento"),i=$("#titular-endereco");e.prop("disabled",a),t.prop("disabled",a),o.prop("disabled",a),n.prop("disabled",a),i.prop("disabled",a)},setCupomDesconto:function(){$("#cupom-add").on("click",function(){var a=$("#link-set-cupom-desconto").attr("link"),e=$("#cupom").val();if(""==e)return swal("Informe o código do cupom","Para adicionar o cupom, insira um valor válido","warning");axios.post(a,{cupom:e}).then(function(a){var e=a.data,t=e.status,o=e.cupom;return 0==t?swal("Cupom inválido","O cupom informado é inválido ou não esta mais disponivel.","warning"):swal("Cupom aplicado","O cupom "+o.nome_interno+" foi aplicado!","success").then(function(){window.location.reload()})})})},unsetCupomDesconto:function(){$("#cupom-remove").on("click",function(){var a=$("#link-unset-cupom-desconto").attr("link");axios.post(a).then(function(a){window.location.reload()})})},loadAcompanhantesSeTitularPreenchido:function(){var a=$("#titular-email").val();void 0==a&&""==a||DadosFactory.loadAcompanhantes(a)},formatarDateJSParaTexto:function(a){var e=a.getDate(),t=a.getMonth()+1,o=a.getFullYear();return e<10&&(e="0"+e),t<10&&(t="0"+t),e+"/"+t+"/"+o},dataToIE:function(a){var e=a.split(" ");return e=e[0].split("-"),new Date(e[0],e[1]-1,e[2],0,0,0,0)}};
